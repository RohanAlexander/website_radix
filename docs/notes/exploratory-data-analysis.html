<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>18 Exploratory data analysis | Telling Stories with Data</title>
  <meta name="description" content="18 Exploratory data analysis | Telling Stories with Data" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="18 Exploratory data analysis | Telling Stories with Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="18 Exploratory data analysis | Telling Stories with Data" />
  
  
  

<meta name="author" content="Rohan Alexander" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="lab-ggplot2.html"/>
<link rel="next" href="case-study-historical-canadian-elections.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="overview.html"><a href="overview.html#on-telling-stories"><i class="fa fa-check"></i><b>1.1</b> On telling stories</a></li>
<li class="chapter" data-level="1.2" data-path="overview.html"><a href="overview.html#telling-stories-with-data"><i class="fa fa-check"></i><b>1.2</b> Telling stories with data</a></li>
<li class="chapter" data-level="1.3" data-path="overview.html"><a href="overview.html#these-notes"><i class="fa fa-check"></i><b>1.3</b> These notes</a><ul>
<li class="chapter" data-level="1.3.1" data-path="overview.html"><a href="overview.html#software"><i class="fa fa-check"></i><b>1.3.1</b> Software</a></li>
<li class="chapter" data-level="1.3.2" data-path="overview.html"><a href="overview.html#assumed-background"><i class="fa fa-check"></i><b>1.3.2</b> Assumed background</a></li>
<li class="chapter" data-level="1.3.3" data-path="overview.html"><a href="overview.html#structure"><i class="fa fa-check"></i><b>1.3.3</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="overview.html"><a href="overview.html#acknowledgements"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.5" data-path="overview.html"><a href="overview.html#contact"><i class="fa fa-check"></i><b>1.5</b> Contact</a></li>
<li class="chapter" data-level="1.6" data-path="overview.html"><a href="overview.html#todos"><i class="fa fa-check"></i><b>1.6</b> TODOs</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab-getting-started.html"><a href="lab-getting-started.html"><i class="fa fa-check"></i><b>2</b> Lab - Getting started</a><ul>
<li class="chapter" data-level="2.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#tidyverse"><i class="fa fa-check"></i><b>2.2</b> Tidyverse</a><ul>
<li class="chapter" data-level="2.2.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#the-pipe"><i class="fa fa-check"></i><b>2.2.1</b> The pipe</a></li>
<li class="chapter" data-level="2.2.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#select"><i class="fa fa-check"></i><b>2.2.2</b> Select</a></li>
<li class="chapter" data-level="2.2.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#filter"><i class="fa fa-check"></i><b>2.2.3</b> Filter</a></li>
<li class="chapter" data-level="2.2.4" data-path="lab-getting-started.html"><a href="lab-getting-started.html#arrange"><i class="fa fa-check"></i><b>2.2.4</b> Arrange</a></li>
<li class="chapter" data-level="2.2.5" data-path="lab-getting-started.html"><a href="lab-getting-started.html#group_by"><i class="fa fa-check"></i><b>2.2.5</b> group_by</a></li>
<li class="chapter" data-level="2.2.6" data-path="lab-getting-started.html"><a href="lab-getting-started.html#mutate"><i class="fa fa-check"></i><b>2.2.6</b> Mutate</a></li>
<li class="chapter" data-level="2.2.7" data-path="lab-getting-started.html"><a href="lab-getting-started.html#summarise"><i class="fa fa-check"></i><b>2.2.7</b> Summarise</a></li>
<li class="chapter" data-level="2.2.8" data-path="lab-getting-started.html"><a href="lab-getting-started.html#counting-by-group"><i class="fa fa-check"></i><b>2.2.8</b> Counting by group</a></li>
<li class="chapter" data-level="2.2.9" data-path="lab-getting-started.html"><a href="lab-getting-started.html#calculate-proportions"><i class="fa fa-check"></i><b>2.2.9</b> Calculate proportions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#ggplot"><i class="fa fa-check"></i><b>2.3</b> ggplot</a><ul>
<li class="chapter" data-level="2.3.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#main-features"><i class="fa fa-check"></i><b>2.3.1</b> Main features</a></li>
<li class="chapter" data-level="2.3.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#facets"><i class="fa fa-check"></i><b>2.3.2</b> Facets</a></li>
<li class="chapter" data-level="2.3.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#small-things"><i class="fa fa-check"></i><b>2.3.3</b> Small things</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lab-getting-started.html"><a href="lab-getting-started.html#other"><i class="fa fa-check"></i><b>2.4</b> Other</a><ul>
<li class="chapter" data-level="2.4.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#case_when"><i class="fa fa-check"></i><b>2.4.1</b> case_when</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html"><i class="fa fa-check"></i><b>3</b> Case study - The 2019 Canadian Federal Election</a><ul>
<li class="chapter" data-level="3.1" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#create-a-graph-based-on-the-2019-canadian-federal-election"><i class="fa fa-check"></i><b>3.2</b> Create a graph based on the 2019 Canadian Federal election</a><ul>
<li class="chapter" data-level="3.2.1" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#getting-started"><i class="fa fa-check"></i><b>3.2.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2.2" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#reading-in-the-data"><i class="fa fa-check"></i><b>3.2.2</b> Reading in the data</a></li>
<li class="chapter" data-level="3.2.3" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#clean-the-data"><i class="fa fa-check"></i><b>3.2.3</b> Clean the data</a></li>
<li class="chapter" data-level="3.2.4" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#make-a-graph"><i class="fa fa-check"></i><b>3.2.4</b> Make a graph</a></li>
<li class="chapter" data-level="3.2.5" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#make-a-table"><i class="fa fa-check"></i><b>3.2.5</b> Make a table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>4</b> Communication</a><ul>
<li class="chapter" data-level="4.1" data-path="communication.html"><a href="communication.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="communication.html"><a href="communication.html#title-abstract-and-introduction"><i class="fa fa-check"></i><b>4.2</b> Title, abstract, and introduction</a></li>
<li class="chapter" data-level="4.3" data-path="communication.html"><a href="communication.html#figures-tables-equations-and-technical-terms"><i class="fa fa-check"></i><b>4.3</b> Figures, tables, equations, and technical terms</a></li>
<li class="chapter" data-level="4.4" data-path="communication.html"><a href="communication.html#on-brevity"><i class="fa fa-check"></i><b>4.4</b> On brevity</a></li>
<li class="chapter" data-level="4.5" data-path="communication.html"><a href="communication.html#other-1"><i class="fa fa-check"></i><b>4.5</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html"><i class="fa fa-check"></i><b>5</b> Lab - Using R in practice</a><ul>
<li class="chapter" data-level="5.1" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#getting-help"><i class="fa fa-check"></i><b>5.2</b> Getting help</a></li>
<li class="chapter" data-level="5.3" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#mentality"><i class="fa fa-check"></i><b>5.3</b> Mentality</a></li>
<li class="chapter" data-level="5.4" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#style"><i class="fa fa-check"></i><b>5.4</b> Style</a></li>
<li class="chapter" data-level="5.5" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#learning-more"><i class="fa fa-check"></i><b>5.5</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ethics.html"><a href="ethics.html"><i class="fa fa-check"></i><b>6</b> Ethics</a><ul>
<li class="chapter" data-level="6.1" data-path="ethics.html"><a href="ethics.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ethics.html"><a href="ethics.html#questiontask"><i class="fa fa-check"></i><b>6.2</b> Question/task</a></li>
<li class="chapter" data-level="6.3" data-path="ethics.html"><a href="ethics.html#data"><i class="fa fa-check"></i><b>6.3</b> Data</a></li>
<li class="chapter" data-level="6.4" data-path="ethics.html"><a href="ethics.html#model"><i class="fa fa-check"></i><b>6.4</b> Model</a></li>
<li class="chapter" data-level="6.5" data-path="ethics.html"><a href="ethics.html#team"><i class="fa fa-check"></i><b>6.5</b> Team</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>7</b> Reproducibility</a><ul>
<li class="chapter" data-level="7.1" data-path="reproducibility.html"><a href="reproducibility.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="reproducibility.html"><a href="reproducibility.html#data-access"><i class="fa fa-check"></i><b>7.2</b> Data access</a></li>
<li class="chapter" data-level="7.3" data-path="reproducibility.html"><a href="reproducibility.html#on-mistakes"><i class="fa fa-check"></i><b>7.3</b> On mistakes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html"><i class="fa fa-check"></i><b>8</b> Lab - R Markdown and R Projects</a><ul>
<li class="chapter" data-level="8.1" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-markdown"><i class="fa fa-check"></i><b>8.1</b> R Markdown</a><ul>
<li class="chapter" data-level="8.1.1" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#getting-started-1"><i class="fa fa-check"></i><b>8.1.1</b> Getting started</a></li>
<li class="chapter" data-level="8.1.2" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#basic-commands"><i class="fa fa-check"></i><b>8.1.2</b> Basic commands</a></li>
<li class="chapter" data-level="8.1.3" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-chunks"><i class="fa fa-check"></i><b>8.1.3</b> R chunks</a></li>
<li class="chapter" data-level="8.1.4" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#abstracts-and-pdf-outputs"><i class="fa fa-check"></i><b>8.1.4</b> Abstracts and PDF outputs</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-projects"><i class="fa fa-check"></i><b>8.2</b> R projects</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lab-git-and-docker.html"><a href="lab-git-and-docker.html"><i class="fa fa-check"></i><b>9</b> Lab - Git and Docker</a></li>
<li class="chapter" data-level="10" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html"><i class="fa fa-check"></i><b>10</b> Case study - TTC Subway Delays</a><ul>
<li class="chapter" data-level="10.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#introduction-6"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="10.1.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#prerequesites"><i class="fa fa-check"></i><b>10.1.1</b> Prerequesites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#finding-and-downloading-data-using-opendatatoronto"><i class="fa fa-check"></i><b>10.2</b> Finding and downloading data using <code>opendatatoronto</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#finding-the-data"><i class="fa fa-check"></i><b>10.2.1</b> Finding the data</a></li>
<li class="chapter" data-level="10.2.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#retrieving-the-data"><i class="fa fa-check"></i><b>10.2.2</b> Retrieving the data</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#plotting"><i class="fa fa-check"></i><b>10.3</b> Plotting</a><ul>
<li class="chapter" data-level="10.3.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#example-1-delays-by-line"><i class="fa fa-check"></i><b>10.3.1</b> Example 1: Delays by line</a></li>
<li class="chapter" data-level="10.3.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#example-2-delays-by-time-of-day"><i class="fa fa-check"></i><b>10.3.2</b> Example 2: Delays by time of day</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="problem-set-1.html"><a href="problem-set-1.html"><i class="fa fa-check"></i><b>11</b> Problem Set 1</a></li>
<li class="chapter" data-level="12" data-path="developing-research-questions.html"><a href="developing-research-questions.html"><i class="fa fa-check"></i><b>12</b> Developing research questions</a><ul>
<li class="chapter" data-level="12.1" data-path="developing-research-questions.html"><a href="developing-research-questions.html#developing-research-questions-1"><i class="fa fa-check"></i><b>12.1</b> Developing research questions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gathering-data.html"><a href="gathering-data.html"><i class="fa fa-check"></i><b>13</b> Gathering data</a><ul>
<li class="chapter" data-level="13.1" data-path="gathering-data.html"><a href="gathering-data.html#gathering-data-1"><i class="fa fa-check"></i><b>13.1</b> Gathering data</a><ul>
<li class="chapter" data-level="13.1.1" data-path="gathering-data.html"><a href="gathering-data.html#deliberately-available"><i class="fa fa-check"></i><b>13.1.1</b> Deliberately available</a></li>
<li class="chapter" data-level="13.1.2" data-path="gathering-data.html"><a href="gathering-data.html#by-product"><i class="fa fa-check"></i><b>13.1.2</b> By product</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="lab-the-tidyverse.html"><a href="lab-the-tidyverse.html"><i class="fa fa-check"></i><b>14</b> Lab - The Tidyverse</a></li>
<li class="chapter" data-level="15" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html"><i class="fa fa-check"></i><b>15</b> Case study - Gathering and tidying data from Paspaley</a><ul>
<li class="chapter" data-level="15.1" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#introduction-7"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#data-acquisition"><i class="fa fa-check"></i><b>15.2</b> Data acquisition</a></li>
<li class="chapter" data-level="15.3" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#data-cleaning"><i class="fa fa-check"></i><b>15.3</b> Data cleaning</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html"><i class="fa fa-check"></i><b>16</b> Case study - Rohan’s books</a><ul>
<li class="chapter" data-level="16.1" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#introduction-8"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#gather-data"><i class="fa fa-check"></i><b>16.2</b> Gather data</a></li>
<li class="chapter" data-level="16.3" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#data-parsing-and-cleaning"><i class="fa fa-check"></i><b>16.3</b> Data parsing and cleaning</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="lab-ggplot2.html"><a href="lab-ggplot2.html"><i class="fa fa-check"></i><b>17</b> Lab - ggplot2</a></li>
<li class="chapter" data-level="18" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>18</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="18.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-9"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#a-note-on-packages"><i class="fa fa-check"></i><b>18.2</b> A note on packages</a></li>
<li class="chapter" data-level="18.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#ttc-subway-delays"><i class="fa fa-check"></i><b>18.3</b> TTC subway delays</a></li>
<li class="chapter" data-level="18.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#eda-and-data-viz"><i class="fa fa-check"></i><b>18.4</b> EDA and data viz</a></li>
<li class="chapter" data-level="18.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-checks"><i class="fa fa-check"></i><b>18.5</b> Data checks</a><ul>
<li class="chapter" data-level="18.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#sanity-checks"><i class="fa fa-check"></i><b>18.5.1</b> Sanity Checks</a></li>
<li class="chapter" data-level="18.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>18.5.2</b> Missing values</a></li>
<li class="chapter" data-level="18.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#duplicates"><i class="fa fa-check"></i><b>18.5.3</b> Duplicates?</a></li>
<li class="chapter" data-level="18.5.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-distributions"><i class="fa fa-check"></i><b>18.5.4</b> Visualizing distributions</a></li>
<li class="chapter" data-level="18.5.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-time-series"><i class="fa fa-check"></i><b>18.5.5</b> Visualizing time series</a></li>
<li class="chapter" data-level="18.5.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-relationships"><i class="fa fa-check"></i><b>18.5.6</b> Visualizing relationships</a></li>
<li class="chapter" data-level="18.5.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#pca"><i class="fa fa-check"></i><b>18.5.7</b> PCA</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises"><i class="fa fa-check"></i><b>18.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="case-study-historical-canadian-elections.html"><a href="case-study-historical-canadian-elections.html"><i class="fa fa-check"></i><b>19</b> Case study - Historical Canadian elections</a></li>
<li class="chapter" data-level="20" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>20</b> Linear regression</a><ul>
<li class="chapter" data-level="20.1" data-path="linear-regression.html"><a href="linear-regression.html#introduction-10"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="linear-regression.html"><a href="linear-regression.html#competing-relationships"><i class="fa fa-check"></i><b>20.2</b> Competing relationships</a></li>
<li class="chapter" data-level="20.3" data-path="linear-regression.html"><a href="linear-regression.html#implementing-this-in-r"><i class="fa fa-check"></i><b>20.3</b> Implementing this in R</a></li>
<li class="chapter" data-level="20.4" data-path="linear-regression.html"><a href="linear-regression.html#tidy-up-with-broom"><i class="fa fa-check"></i><b>20.4</b> Tidy up with broom</a></li>
<li class="chapter" data-level="20.5" data-path="linear-regression.html"><a href="linear-regression.html#testing-hypothesis"><i class="fa fa-check"></i><b>20.5</b> Testing hypothesis</a></li>
<li class="chapter" data-level="20.6" data-path="linear-regression.html"><a href="linear-regression.html#adding-more-and-varied-explanatory-variables"><i class="fa fa-check"></i><b>20.6</b> Adding more and varied explanatory variables</a></li>
<li class="chapter" data-level="20.7" data-path="linear-regression.html"><a href="linear-regression.html#threats-to-validity-and-aspects-to-think-about"><i class="fa fa-check"></i><b>20.7</b> Threats to validity and aspects to think about</a></li>
<li class="chapter" data-level="20.8" data-path="linear-regression.html"><a href="linear-regression.html#more-credible-outputs"><i class="fa fa-check"></i><b>20.8</b> More credible outputs</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="lab-reporting-regression-results.html"><a href="lab-reporting-regression-results.html"><i class="fa fa-check"></i><b>21</b> Lab - Reporting regression results</a></li>
<li class="chapter" data-level="22" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html"><i class="fa fa-check"></i><b>22</b> Case study - Opinions about a casino in Toronto</a><ul>
<li class="chapter" data-level="22.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#data-preparation"><i class="fa fa-check"></i><b>22.1</b> Data preparation</a><ul>
<li class="chapter" data-level="22.1.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-data-from-opendatatoronto"><i class="fa fa-check"></i><b>22.1.1</b> Getting data from <code>opendatatoronto</code></a></li>
<li class="chapter" data-level="22.1.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-the-right-kind-of-object"><i class="fa fa-check"></i><b>22.1.2</b> Getting the right kind of object</a></li>
<li class="chapter" data-level="22.1.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#cleaning-up-the-dataframe"><i class="fa fa-check"></i><b>22.1.3</b> Cleaning up the dataframe</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#some-visual-exploration-and-more-cleanup-of-course"><i class="fa fa-check"></i><b>22.2</b> Some visual exploration (and more cleanup, of course)</a><ul>
<li class="chapter" data-level="22.2.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-the-data-into-a-more-model-suitable-format"><i class="fa fa-check"></i><b>22.2.1</b> Getting the data into a more model-suitable format</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#logistic-regression"><i class="fa fa-check"></i><b>22.3</b> Logistic Regression</a><ul>
<li class="chapter" data-level="22.3.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#interpretation"><i class="fa fa-check"></i><b>22.3.1</b> Interpretation</a></li>
<li class="chapter" data-level="22.3.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#baseline-category"><i class="fa fa-check"></i><b>22.3.2</b> Baseline category</a></li>
<li class="chapter" data-level="22.3.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#making-estimates"><i class="fa fa-check"></i><b>22.3.3</b> Making estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html"><i class="fa fa-check"></i><b>23</b> Case study - Airbnb listing in Toronto</a><ul>
<li class="chapter" data-level="23.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#essentials"><i class="fa fa-check"></i><b>23.1</b> Essentials</a></li>
<li class="chapter" data-level="23.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#set-up"><i class="fa fa-check"></i><b>23.2</b> Set up</a></li>
<li class="chapter" data-level="23.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#get-data"><i class="fa fa-check"></i><b>23.3</b> Get data</a></li>
<li class="chapter" data-level="23.4" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#clean-data"><i class="fa fa-check"></i><b>23.4</b> Clean data</a><ul>
<li class="chapter" data-level="23.4.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#price"><i class="fa fa-check"></i><b>23.4.1</b> Price</a></li>
<li class="chapter" data-level="23.4.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#superhosts"><i class="fa fa-check"></i><b>23.4.2</b> Superhosts</a></li>
<li class="chapter" data-level="23.4.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#reviews"><i class="fa fa-check"></i><b>23.4.3</b> Reviews</a></li>
<li class="chapter" data-level="23.4.4" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#response-time"><i class="fa fa-check"></i><b>23.4.4</b> Response time</a></li>
<li class="chapter" data-level="23.4.5" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#host-number-of-listings"><i class="fa fa-check"></i><b>23.4.5</b> Host number of listings</a></li>
<li class="chapter" data-level="23.4.6" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#decisions"><i class="fa fa-check"></i><b>23.4.6</b> Decisions</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#explore-data"><i class="fa fa-check"></i><b>23.5</b> Explore data</a><ul>
<li class="chapter" data-level="23.5.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#price-and-reviews"><i class="fa fa-check"></i><b>23.5.1</b> Price and reviews</a></li>
<li class="chapter" data-level="23.5.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#superhost-and-response-time"><i class="fa fa-check"></i><b>23.5.2</b> Superhost and response-time</a></li>
<li class="chapter" data-level="23.5.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#neighbourhood"><i class="fa fa-check"></i><b>23.5.3</b> Neighbourhood</a></li>
</ul></li>
<li class="chapter" data-level="23.6" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#model-data"><i class="fa fa-check"></i><b>23.6</b> Model data</a><ul>
<li class="chapter" data-level="23.6.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#logistic-regression-1"><i class="fa fa-check"></i><b>23.6.1</b> Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="23.7" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#next-steps"><i class="fa fa-check"></i><b>23.7</b> Next steps</a></li>
<li class="chapter" data-level="23.8" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#references"><i class="fa fa-check"></i><b>23.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html"><i class="fa fa-check"></i><b>24</b> A/B testing and RCTs</a><ul>
<li class="chapter" data-level="24.1" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#introduction-11"><i class="fa fa-check"></i><b>24.1</b> Introduction</a></li>
<li class="chapter" data-level="24.2" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#motivation"><i class="fa fa-check"></i><b>24.2</b> Motivation</a></li>
<li class="chapter" data-level="24.3" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#tea-party"><i class="fa fa-check"></i><b>24.3</b> Tea party</a></li>
<li class="chapter" data-level="24.4" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#some-unexpected-properties-from-randomised-sampling"><i class="fa fa-check"></i><b>24.4</b> Some unexpected properties from randomised sampling</a></li>
<li class="chapter" data-level="24.5" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#anova"><i class="fa fa-check"></i><b>24.5</b> ANOVA</a></li>
<li class="chapter" data-level="24.6" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#treatment-and-control"><i class="fa fa-check"></i><b>24.6</b> Treatment and control</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html"><i class="fa fa-check"></i><b>25</b> Matching &amp; difference-in-differences</a><ul>
<li class="chapter" data-level="25.1" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#introduction-12"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#motivation-1"><i class="fa fa-check"></i><b>25.2</b> Motivation</a></li>
<li class="chapter" data-level="25.3" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#example"><i class="fa fa-check"></i><b>25.3</b> Example</a></li>
<li class="chapter" data-level="25.4" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#assumptions"><i class="fa fa-check"></i><b>25.4</b> Assumptions</a></li>
<li class="chapter" data-level="25.5" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#matching"><i class="fa fa-check"></i><b>25.5</b> Matching</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><i class="fa fa-check"></i><b>26</b> Case study - Lower advertising revenue reduced French newspaper prices between 1960 and 1974</a><ul>
<li class="chapter" data-level="26.1" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#introduction-13"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#background"><i class="fa fa-check"></i><b>26.2</b> Background</a></li>
<li class="chapter" data-level="26.3" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#data-1"><i class="fa fa-check"></i><b>26.3</b> Data</a></li>
<li class="chapter" data-level="26.4" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#model-1"><i class="fa fa-check"></i><b>26.4</b> Model</a></li>
<li class="chapter" data-level="26.5" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#results"><i class="fa fa-check"></i><b>26.5</b> Results</a></li>
<li class="chapter" data-level="26.6" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#other-points"><i class="fa fa-check"></i><b>26.6</b> Other points</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="shiny-applications.html"><a href="shiny-applications.html"><i class="fa fa-check"></i><b>27</b> Shiny applications</a></li>
<li class="chapter" data-level="28" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html"><i class="fa fa-check"></i><b>28</b> Regression discontinuity design</a></li>
<li class="chapter" data-level="29" data-path="introduction-14.html"><a href="introduction-14.html"><i class="fa fa-check"></i><b>29</b> Introduction</a></li>
<li class="chapter" data-level="30" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>30</b> Instrumental variables</a></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telling Stories with Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-data-analysis" class="section level1">
<h1><span class="header-section-number">18</span> Exploratory data analysis</h1>
<p><strong>This chapter was written with <a href="https://www.monicaalexander.com/">Monica Alexander</a>.</strong></p>
<p><strong>Required reading</strong></p>
<ul>
<li>Wickham, Hadley, and Garrett Grolemund, 2017, ‘R for Data Science’, Chapters 3 and 7, freely available here: <a href="https://r4ds.had.co.nz/" class="uri">https://r4ds.had.co.nz/</a>.</li>
</ul>
<p><strong>Recommended reading</strong></p>
<ul>
<li>Hall, Megan, 2019, ‘Exploratory Data Analysis Using Tidyverse’, freely available at: <a href="https://hockey-graphs.com/2019/10/08/exploratory-data-analysis-using-tidyverse/" class="uri">https://hockey-graphs.com/2019/10/08/exploratory-data-analysis-using-tidyverse/</a>.</li>
<li>Jordan, Michael I, 2019, ‘AI - The revolution hasn’t started yet’, freely available at: <a href="https://hdsr.mitpress.mit.edu/pub/wot7mkc1" class="uri">https://hdsr.mitpress.mit.edu/pub/wot7mkc1</a>.</li>
<li>Silge, Julia, 2018, ‘Understanding PCA using Stack Overflow data’, freely available at: <a href="https://juliasilge.com/blog/stack-overflow-pca/" class="uri">https://juliasilge.com/blog/stack-overflow-pca/</a>.</li>
<li>Soetewey, Antoine, 2020, ‘Descriptive statistics in R’, freely available at: <a href="https://www.statsandr.com/blog/descriptive-statistics-in-r/" class="uri">https://www.statsandr.com/blog/descriptive-statistics-in-r/</a>.</li>
<li>Stodulka, Jiri, 2019, ‘Toronto Crime and Folium’, freely available at: <a href="https://www.jiristodulka.com/post/toronto-crime/" class="uri">https://www.jiristodulka.com/post/toronto-crime/</a>.</li>
<li>Wong, Julia Carrie, 2020, ‘One year inside Trump’s monumental Facebook campaign’, The Guardian, 29 January, freely available at: <a href="https://www.theguardian.com/us-news/2020/jan/28/donald-trump-facebook-ad-campaign-2020-election" class="uri">https://www.theguardian.com/us-news/2020/jan/28/donald-trump-facebook-ad-campaign-2020-election</a>.</li>
</ul>
<p><strong>Key concepts/skills/etc</strong></p>
<ul>
<li>Quickly coming to terms with a new dataset</li>
</ul>
<p><strong>Key libraries/functions/etc</strong></p>
<ul>
<li><code>tidyverse</code></li>
<li><code>ggplot2</code></li>
</ul>
<p><strong>Pre-quiz</strong></p>
<ul>
<li>In your own words what is exploratory data analysis?</li>
<li>If you have a dataset called ‘my_data’, which has two columns: ‘first_col’ and ‘second_col’, then could you please write some rough R code that would generate a graph (the type of graph doesn’t matter).</li>
<li>Consider a dataset that has 500 rows and 3 columns, so there are 1,500 cells. If 100 of the cells are missing data for at least one of the columns, then would you remove the whole row your dataset or try to run your analysis on the data as is, or some other procedure? What if your dataset had 10,000 rows instead, but the same number of missing cells?</li>
<li>Please note three ways of identifying unusual values.</li>
<li>What is the difference between a categorical and continuous variable?</li>
</ul>
<div id="introduction-9" class="section level2">
<h2><span class="header-section-number">18.1</span> Introduction</h2>
<blockquote>
<p>Exploratory data analysis is never finished, you just die.</p>
</blockquote>
<p>This chapter is about exploratory data analysis (EDA) and data visualization steps in R. The aim is to get you used to working with real data (that has issues) to understand the main characteristics and potential issues.</p>
<p>We will be using the <a href="https://sharlagelfand.github.io/opendatatoronto/"><code>opendatatoronto</code></a> R package, which interfaces with the City of Toronto Open Data Portal.</p>
</div>
<div id="a-note-on-packages" class="section level2">
<h2><span class="header-section-number">18.2</span> A note on packages</h2>
<p>If you are running this Rmd on your local machine, you may need to install various packages used (using the <code>install.packages</code> function).</p>
<p>Load in all the packages we need:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">library</span>(opendatatoronto)</a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb144-3" data-line-number="3"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb144-4" data-line-number="4"><span class="kw">library</span>(skimr)</a>
<a class="sourceLine" id="cb144-5" data-line-number="5"><span class="kw">library</span>(visdat)</a>
<a class="sourceLine" id="cb144-6" data-line-number="6"><span class="kw">library</span>(janitor)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:here&#39;:
## 
##     here</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="kw">library</span>(ggrepel)</a></code></pre></div>
</div>
<div id="ttc-subway-delays" class="section level2">
<h2><span class="header-section-number">18.3</span> TTC subway delays</h2>
<p>This package provides an interface to all data available on the <a href="https://open.toronto.ca/">Open Data Portal</a> provided by the City of Toronto.</p>
<p>Use the <code>list_packages</code> function to look at what’s available</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">all_data &lt;-<span class="st"> </span><span class="kw">list_packages</span>(<span class="dt">limit =</span> <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb152-2" data-line-number="2">all_data</a></code></pre></div>
<pre><code>## # A tibble: 336 x 10
##    title id    topics civic_issues excerpt dataset_category num_resources
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;chr&gt;   &lt;chr&gt;                    &lt;int&gt;
##  1 Dail… 8a6e… City … Affordable … &quot;Daily… Table                        8
##  2 Civi… 7d0d… City … Affordable … &quot;The O… Document                     2
##  3 Body… c405… City … &lt;NA&gt;         &quot;This … Table                        2
##  4 Stre… 1db3… City … Mobility     &quot;Trans… Map                          1
##  5 Stre… 74f6… City … &lt;NA&gt;         &quot;Publi… Map                          1
##  6 Stre… 821f… City … &lt;NA&gt;         &quot;Publi… Map                          1
##  7 Stre… ccfd… City … &lt;NA&gt;         &quot;Poste… Map                          1
##  8 Stre… cf70… City … &lt;NA&gt;         &quot;Poste… Map                          1
##  9 Stre… 99b1… City … &lt;NA&gt;         &quot;Infor… Map                          1
## 10 Stre… 71e6… Trans… &lt;NA&gt;         &quot;Bike … Map                          1
## # … with 326 more rows, and 3 more variables: formats &lt;chr&gt;,
## #   refresh_rate &lt;chr&gt;, last_refreshed &lt;date&gt;</code></pre>
<p>Let’s download the data on TTC subway delays in 2019. There are multiple files for 2019 so we need to get them all and make them into one big dataframe.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">res &lt;-<span class="st"> </span><span class="kw">list_package_resources</span>(<span class="st">&quot;996cfe8d-fb35-40ce-b569-698d51fc683b&quot;</span>)</a>
<a class="sourceLine" id="cb154-2" data-line-number="2">res &lt;-<span class="st"> </span>res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">str_extract</span>(name, <span class="st">&quot;201.?&quot;</span>))</a>
<a class="sourceLine" id="cb154-3" data-line-number="3">delay_<span class="dv">2019</span>_ids &lt;-<span class="st"> </span>res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(year<span class="op">==</span><span class="dv">2019</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(id) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>()</a>
<a class="sourceLine" id="cb154-4" data-line-number="4"></a>
<a class="sourceLine" id="cb154-5" data-line-number="5">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb154-6" data-line-number="6"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(delay_<span class="dv">2019</span>_ids)) {</a>
<a class="sourceLine" id="cb154-7" data-line-number="7">  delay_<span class="dv">2019</span> &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(delay_<span class="dv">2019</span>, <span class="kw">get_resource</span>(delay_<span class="dv">2019</span>_ids[i]))</a>
<a class="sourceLine" id="cb154-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb154-9" data-line-number="9"></a>
<a class="sourceLine" id="cb154-10" data-line-number="10"><span class="co"># make the column names nicer to work with</span></a>
<a class="sourceLine" id="cb154-11" data-line-number="11">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span><span class="kw">clean_names</span>(delay_<span class="dv">2019</span>)</a></code></pre></div>
<p>Let’s also download the delay code and readme, as reference.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">delay_codes &lt;-<span class="st"> </span><span class="kw">get_resource</span>(<span class="st">&quot;fece136b-224a-412a-b191-8d31eb00491e&quot;</span>)</a></code></pre></div>
<pre><code>## New names:
## * `` -&gt; ...1
## * `CODE DESCRIPTION` -&gt; `CODE DESCRIPTION...3`
## * `` -&gt; ...4
## * `` -&gt; ...5
## * `CODE DESCRIPTION` -&gt; `CODE DESCRIPTION...7`</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">delay_data_codebook &lt;-<span class="st"> </span><span class="kw">get_resource</span>(<span class="st">&quot;54247e39-5a7d-40db-a137-82b2a9ab0708&quot;</span>)</a></code></pre></div>
<p>This dataset has a bunch of interesting variables. You can refer to the readme for descriptions. Our outcome of interest is <code>min_delay</code>, which give the delay in mins.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">head</span>(delay_<span class="dv">2019</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 10
##   date                time  day   station code  min_delay min_gap bound line 
##   &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 2019-01-01 00:00:00 01:08 Tues… YORK M… PUSI          0       0 S     YU   
## 2 2019-01-01 00:00:00 02:14 Tues… ST AND… PUMST         0       0 &lt;NA&gt;  YU   
## 3 2019-01-01 00:00:00 02:16 Tues… JANE S… TUSC          0       0 W     BD   
## 4 2019-01-01 00:00:00 02:27 Tues… BLOOR … SUO           0       0 N     YU   
## 5 2019-01-01 00:00:00 03:03 Tues… DUPONT… MUATC        11      16 N     YU   
## 6 2019-01-01 00:00:00 03:08 Tues… EGLINT… EUATC        11      16 S     YU   
## # … with 1 more variable: vehicle &lt;dbl&gt;</code></pre>
</div>
<div id="eda-and-data-viz" class="section level2">
<h2><span class="header-section-number">18.4</span> EDA and data viz</h2>
<p>The following section highlights some tools that might be useful for you when you are getting used to a new dataset. There’s no one way of exploration, but it’s important to always keep in mind:</p>
<ul>
<li>what should your variables look like (type, values, distribution, etc)</li>
<li>what would be surprising (outliers etc)</li>
<li>what is your end goal (here, it might be understanding factors associated with delays, e.g. stations, time of year, time of day, etc)</li>
</ul>
<p>In any data analysis project, if it turns out you have data issues, surprising values, missing data etc, it’s important you <strong>document</strong> anything you found and the subsequent steps or <strong>assumptions</strong> you made before moving onto your data analysis / modeling.</p>
<p>As always:</p>
<ol style="list-style-type: decimal">
<li>Start with an end in mind.</li>
<li>Be as lazy as possible.</li>
</ol>
</div>
<div id="data-checks" class="section level2">
<h2><span class="header-section-number">18.5</span> Data checks</h2>
<div id="sanity-checks" class="section level3">
<h3><span class="header-section-number">18.5.1</span> Sanity Checks</h3>
<p>We need to check variables should be what they say they are. If they aren’t, the natural next question is to what to do with issues (recode? remove?)</p>
<p>E.g. check days of week</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="kw">unique</span>(delay_<span class="dv">2019</span><span class="op">$</span>day)</a></code></pre></div>
<pre><code>## [1] &quot;Tuesday&quot;   &quot;Wednesday&quot; &quot;Thursday&quot;  &quot;Friday&quot;    &quot;Saturday&quot;  &quot;Sunday&quot;   
## [7] &quot;Monday&quot;</code></pre>
<p>Check lines: oh no. some issues here. Some have obvious recodes, others, not so much.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="kw">unique</span>(delay_<span class="dv">2019</span><span class="op">$</span>line)</a></code></pre></div>
<pre><code>##  [1] &quot;YU&quot;                     &quot;BD&quot;                     &quot;YU/BD&quot;                 
##  [4] &quot;SHP&quot;                    &quot;SRT&quot;                    NA                      
##  [7] &quot;YUS&quot;                    &quot;B/D&quot;                    &quot;BD LINE&quot;               
## [10] &quot;999&quot;                    &quot;YU/ BD&quot;                 &quot;YU &amp; BD&quot;               
## [13] &quot;BD/YU&quot;                  &quot;YU\\BD&quot;                 &quot;46 MARTIN GROVE&quot;       
## [16] &quot;RT&quot;                     &quot;BLOOR-DANFORTH&quot;         &quot;YU / BD&quot;               
## [19] &quot;134 PROGRESS&quot;           &quot;YU - BD&quot;                &quot;985 SHEPPARD EAST EXPR&quot;
## [22] &quot;22 COXWELL&quot;             &quot;100 FLEMINGDON PARK&quot;    &quot;YU LINE&quot;</code></pre>
<p>The <code>skimr</code> package might also be useful here</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="kw">skim</span>(delay_<span class="dv">2019</span>)</a></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-82">Table 18.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">delay_2019</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">19222</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">10</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">6</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">time</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1380</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">day</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">station</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">22</td>
<td align="right">0</td>
<td align="right">264</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">code</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">185</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">bound</td>
<td align="right">4380</td>
<td align="right">0.77</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">line</td>
<td align="right">50</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">22</td>
<td align="right">0</td>
<td align="right">23</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">min_delay</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">2.41</td>
<td align="right">8.49</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">455</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">min_gap</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3.54</td>
<td align="right">9.22</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">460</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">vehicle</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">3974.44</td>
<td align="right">2455.91</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">5239</td>
<td align="right">5671</td>
<td align="right">9206</td>
<td align="left">▆▁▇▆▁</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2019-01-01</td>
<td align="left">2019-12-31</td>
<td align="left">2019-06-27</td>
<td align="right">365</td>
</tr>
</tbody>
</table>
<p>What are the different values of <code>bound</code> for each <code>line</code>?</p>
<p>For simplicity, just keep the correct line labels.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(line <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;BD&quot;</span>, <span class="st">&quot;YU&quot;</span>, <span class="st">&quot;SHP&quot;</span>, <span class="st">&quot;SRT&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bound =</span> <span class="kw">as.factor</span>(bound)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(line) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb165-5" data-line-number="5"><span class="st">  </span><span class="kw">skim</span>(bound)</a></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-83">Table 18.2: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">18774</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">10</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">line</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="left">line</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bound</td>
<td align="left">BD</td>
<td align="right">1721</td>
<td align="right">0.79</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">W: 3285, E: 3187, S: 4, N: 3</td>
</tr>
<tr class="even">
<td align="left">bound</td>
<td align="left">SHP</td>
<td align="right">156</td>
<td align="right">0.74</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">E: 242, W: 201, B: 1, N: 0</td>
</tr>
<tr class="odd">
<td align="left">bound</td>
<td align="left">SRT</td>
<td align="right">210</td>
<td align="right">0.70</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">N: 235, S: 232, E: 10, W: 7</td>
</tr>
<tr class="even">
<td align="left">bound</td>
<td align="left">YU</td>
<td align="right">1860</td>
<td align="right">0.80</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">S: 3993, N: 3407, E: 10, W: 4</td>
</tr>
</tbody>
</table>
</div>
<div id="missing-values" class="section level3">
<h3><span class="header-section-number">18.5.2</span> Missing values</h3>
<p>Look to see how many NAs by variable</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise_all</span>(<span class="dt">.funs =</span> <span class="kw">funs</span>(<span class="kw">sum</span>(<span class="kw">is.na</span>(.))<span class="op">/</span><span class="kw">nrow</span>(delay_<span class="dv">2019</span>)<span class="op">*</span><span class="dv">100</span>))</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 1 x 10
##    date  time   day station  code min_delay min_gap bound  line vehicle
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1     0     0     0       0     0         0       0  22.8 0.260       0</code></pre>
<p>The <code>visdat</code> package is also useful here, particularly to see how missing values are distributed.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="kw">vis_dat</span>(delay_<span class="dv">2019</span>)</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="kw">vis_miss</span>(delay_<span class="dv">2019</span>)</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-85-2.png" width="672" /></p>
</div>
<div id="duplicates" class="section level3">
<h3><span class="header-section-number">18.5.3</span> Duplicates?</h3>
<p>The <code>get_dupes</code> function from the <code>janitor</code> package is useful for this.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="kw">get_dupes</span>(delay_<span class="dv">2019</span>)</a></code></pre></div>
<pre><code>## No variable names specified - using all columns.</code></pre>
<pre><code>## # A tibble: 158 x 11
##    date                time  day   station code  min_delay min_gap bound line 
##    &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
##  1 2019-01-01 00:00:00 08:18 Tues… DONLAN… MUESA         5      10 W     BD   
##  2 2019-01-01 00:00:00 08:18 Tues… DONLAN… MUESA         5      10 W     BD   
##  3 2019-02-01 00:00:00 05:51 Frid… SCARB … MRTO         10      15 S     SRT  
##  4 2019-02-01 00:00:00 05:51 Frid… SCARB … MRTO         10      15 S     SRT  
##  5 2019-02-01 00:00:00 06:45 Frid… MIDLAN… MRWEA         3       8 S     SRT  
##  6 2019-02-01 00:00:00 06:45 Frid… MIDLAN… MRWEA         3       8 S     SRT  
##  7 2019-02-01 00:00:00 06:55 Frid… LAWREN… ERDO          0       0 S     SRT  
##  8 2019-02-01 00:00:00 06:55 Frid… LAWREN… ERDO          0       0 S     SRT  
##  9 2019-02-01 00:00:00 07:16 Frid… MCCOWA… MRWEA         5      10 N     SRT  
## 10 2019-02-01 00:00:00 07:16 Frid… MCCOWA… MRWEA         5      10 N     SRT  
## # … with 148 more rows, and 2 more variables: vehicle &lt;dbl&gt;, dupe_count &lt;int&gt;</code></pre>
<p>There are quite a few duplicates. Remove for now:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>()</a></code></pre></div>
</div>
<div id="visualizing-distributions" class="section level3">
<h3><span class="header-section-number">18.5.4</span> Visualizing distributions</h3>
<p>Histograms, barplots, and density plots are your friends here.</p>
<p>Let’s look at the outcome of interest: <code>min_delay</code>. First of all just a histogram of all the data:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1"><span class="co">## Removing the observations that have non-standardized lines</span></a>
<a class="sourceLine" id="cb175-2" data-line-number="2"></a>
<a class="sourceLine" id="cb175-3" data-line-number="3">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(line <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;BD&quot;</span>, <span class="st">&quot;YU&quot;</span>, <span class="st">&quot;SHP&quot;</span>, <span class="st">&quot;SRT&quot;</span>))</a>
<a class="sourceLine" id="cb175-4" data-line-number="4"></a>
<a class="sourceLine" id="cb175-5" data-line-number="5"><span class="kw">ggplot</span>(<span class="dt">data =</span> delay_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb175-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> min_delay))</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p>To improve readability, could plot on logged scale:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> delay_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb177-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> min_delay)) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 11944 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>Our initial EDA hinted at an outlying delay time, let’s take a look at the largest delays below. Join the <code>delay_codes</code> dataset to see what the delay is. (Have to do some mangling as SRT has different codes).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb181-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(delay_codes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">code =</span> <span class="st">`</span><span class="dt">SUB RMENU CODE</span><span class="st">`</span>, <span class="dt">code_desc =</span> <span class="st">`</span><span class="dt">CODE DESCRIPTION...3</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(code, code_desc)) </a></code></pre></div>
<pre><code>## Joining, by = &quot;code&quot;</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb183-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">code_srt =</span> <span class="kw">ifelse</span>(line<span class="op">==</span><span class="st">&quot;SRT&quot;</span>, code, <span class="st">&quot;NA&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb183-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(delay_codes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">code_srt =</span> <span class="st">`</span><span class="dt">SRT RMENU CODE</span><span class="st">`</span>, <span class="dt">code_desc_srt =</span> <span class="st">`</span><span class="dt">CODE DESCRIPTION...7</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(code_srt, code_desc_srt))  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb183-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">code =</span> <span class="kw">ifelse</span>(code_srt<span class="op">==</span><span class="st">&quot;NA&quot;</span>, code, code_srt),</a>
<a class="sourceLine" id="cb183-5" data-line-number="5">         <span class="dt">code_desc =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(code_desc_srt), code_desc, code_desc_srt)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb183-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>code_srt, <span class="op">-</span>code_desc_srt)</a></code></pre></div>
<pre><code>## Joining, by = &quot;code_srt&quot;</code></pre>
<p>The 455 min delay due to ‘Rail Related Problem’ is an outlier.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb185-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(delay_codes <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">code =</span> <span class="st">`</span><span class="dt">SUB RMENU CODE</span><span class="st">`</span>, <span class="dt">code_desc =</span> <span class="st">`</span><span class="dt">CODE DESCRIPTION...3</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(code, code_desc)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb185-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>min_delay) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb185-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(date, time, station, line, min_delay, code, code_desc)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;code&quot;, &quot;code_desc&quot;)</code></pre>
<pre><code>## # A tibble: 18,697 x 7
##    date                time  station     line  min_delay code  code_desc        
##    &lt;dttm&gt;              &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;            
##  1 2019-06-25 00:00:00 18:48 WILSON TO … YU          455 PUTR  Rail Related Pro…
##  2 2019-02-12 00:00:00 20:28 LAWRENCE E… SRT         284 MRWEA Weather Reports …
##  3 2019-06-05 00:00:00 12:42 UNION TO S… YU          250 MUPLA Fire/Smoke Plan A
##  4 2019-10-22 00:00:00 14:22 LAWRENCE S… YU          228 PUTS  Structure Relate…
##  5 2019-09-26 00:00:00 11:38 YORK MILLS… YU          193 MUPR1 Priority One - T…
##  6 2019-06-08 00:00:00 08:51 SPADINA BD… BD          180 MUPLB Fire/Smoke Plan …
##  7 2019-12-02 00:00:00 06:59 DUNDAS WES… BD          176 MUPLB Fire/Smoke Plan …
##  8 2019-01-29 00:00:00 05:46 VICTORIA P… BD          174 MUWEA Weather Reports …
##  9 2019-02-22 00:00:00 17:32 ELLESMERE … SRT         168 PRW   Rail Defect/Fast…
## 10 2019-02-10 00:00:00 07:53 BAYVIEW ST… SHP         165 PUSI  Signals or Relat…
## # … with 18,687 more rows</code></pre>
<div id="grouping-and-small-multiples" class="section level4">
<h4><span class="header-section-number">18.5.4.1</span> Grouping and small multiples</h4>
<p>A quick and powerful visualization technique is to group the data by a variable of interest, e.g. <code>line</code></p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> delay_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> min_delay, <span class="dt">y =</span> ..density.., <span class="dt">fill =</span> line), <span class="dt">position =</span> <span class="st">&#39;dodge&#39;</span>, <span class="dt">bins =</span> <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 11944 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p>I switched to density above to look at the the distributions more comparably, but we should also be aware of differences in frequency, in particular, SHP and SRT have much smaller counts:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> delay_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x =</span> min_delay, <span class="dt">fill =</span> line), <span class="dt">position =</span> <span class="st">&#39;dodge&#39;</span>, <span class="dt">bins =</span> <span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 11944 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-93-1.png" width="672" /></p>
<p>If you want to group by more than one variable, facets are good:</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> delay_<span class="dv">2019</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(<span class="dt">x =</span> min_delay, <span class="dt">color =</span> day), <span class="dt">bw =</span> <span class="fl">.08</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb194-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="op">~</span>line)</a></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 11944 rows containing non-finite values (stat_density).</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>Side note: the station names are a mess. Try and clean up the station names a bit by taking just the first word (or, the first two if it starts with “ST”):</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb197-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">station_clean =</span> <span class="kw">ifelse</span>(<span class="kw">str_starts</span>(station, <span class="st">&quot;ST&quot;</span>), <span class="kw">word</span>(station, <span class="dv">1</span>,<span class="dv">2</span>), <span class="kw">word</span>(station, <span class="dv">1</span>)))</a></code></pre></div>
<p>Plot top five stations by mean delay:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(line, station_clean) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_delay =</span> <span class="kw">mean</span>(min_delay), <span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(n_obs<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(line, <span class="op">-</span>mean_delay) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-6" data-line-number="6"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(station_clean, mean_delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_flip</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_wrap</span>(<span class="op">~</span>line, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-96-1.png" width="672" /></p>
</div>
</div>
<div id="visualizing-time-series" class="section level3">
<h3><span class="header-section-number">18.5.5</span> Visualizing time series</h3>
<p>Daily plot is messy (you can check for yourself). Let’s look by week to see if there’s any seasonality. The <code>lubridate</code> package has lots of helpful functions that deal with date variables. First, mean delay (of those that were delayed more than 0 mins):</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb199-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(min_delay<span class="op">&gt;</span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb199-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">week =</span> <span class="kw">week</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb199-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(week, line) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb199-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_delay =</span> <span class="kw">mean</span>(min_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb199-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(week, mean_delay, <span class="dt">color =</span> line)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="op">~</span>line)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>What about proportion of delays that were greater than 10 mins?</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb201-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">week =</span> <span class="kw">week</span>(date)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb201-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(week, line) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb201-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop_delay =</span> <span class="kw">sum</span>(min_delay<span class="op">&gt;</span><span class="dv">10</span>)<span class="op">/</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb201-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(week, prop_delay, <span class="dt">color =</span> line)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_smooth</span>() <span class="op">+</span><span class="st"> </span><span class="kw">facet_grid</span>(<span class="op">~</span>line)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="notes_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
</div>
<div id="visualizing-relationships" class="section level3">
<h3><span class="header-section-number">18.5.6</span> Visualizing relationships</h3>
<p>Note that <strong>scatter plots</strong> are a good precursor to modeling, to visualize relationships between continuous variables. Nothing obvious to plot here, but easy to do with <code>geom_point</code>.</p>
<p>Look at top five reasons for delay by station. Do they differ? Think about how this could be modeled.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1">delay_<span class="dv">2019</span> <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(line, code_desc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_delay =</span> <span class="kw">mean</span>(min_delay)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span>mean_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-5" data-line-number="5"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb203-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> code_desc,</a>
<a class="sourceLine" id="cb203-7" data-line-number="7">             <span class="dt">y =</span> mean_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb203-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="kw">vars</span>(line), </a>
<a class="sourceLine" id="cb203-10" data-line-number="10">             <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>,</a>
<a class="sourceLine" id="cb203-11" data-line-number="11">             <span class="dt">nrow =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb203-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-99-1.png" width="672" /></p>
</div>
<div id="pca" class="section level3">
<h3><span class="header-section-number">18.5.7</span> PCA</h3>
<p>Principal components analysis is a really powerful exploratory tool. It allows you to pick up potential clusters and/or outliers that can help to inform model building.</p>
<p>Let’s do a quick (and imperfect) example looking at types of delays by station.</p>
<p>The delay categories are a bit of a mess, and there’s hundreds of them. As a simple start, let’s just take the first word:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">delay_<span class="dv">2019</span> &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb204-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">code_red =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb204-3" data-line-number="3">    <span class="kw">str_starts</span>(code_desc, <span class="st">&quot;No&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="kw">word</span>(code_desc, <span class="dv">1</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb204-4" data-line-number="4">    <span class="kw">str_starts</span>(code_desc, <span class="st">&quot;Operator&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="kw">word</span>(code_desc, <span class="dv">1</span>,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb204-5" data-line-number="5">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">word</span>(code_desc,<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb204-6" data-line-number="6">         )</a></code></pre></div>
<p>Let’s also just restrict the analysis to causes that happen at least 50 times over 2019. To do the PCA, the dataframe also needs to be switched to wide format:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1">dwide &lt;-<span class="st"> </span>delay_<span class="dv">2019</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(line, station_clean) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_obs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(n_obs<span class="op">&gt;</span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(code_red) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tot_delay =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-7" data-line-number="7"><span class="st">  </span><span class="kw">arrange</span>(tot_delay) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(tot_delay<span class="op">&gt;</span><span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(line, station_clean, code_red) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-10" data-line-number="10"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_delay =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-11" data-line-number="11"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> code_red, <span class="dt">values_from =</span> n_delay) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb205-12" data-line-number="12"><span class="st">  </span><span class="kw">mutate_all</span>(<span class="dt">.funs =</span> <span class="kw">funs</span>(<span class="kw">ifelse</span>(<span class="kw">is.na</span>(.), <span class="dv">0</span>, .)))</a></code></pre></div>
<pre><code>## `mutate_all()` ignored the following grouping variables:
## Columns `line`, `station_clean`
## Use `mutate_at(df, vars(-group_cols()), myoperation)` to silence the message.</code></pre>
<p>Do the PCA:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">delay_pca &lt;-<span class="st"> </span><span class="kw">prcomp</span>(dwide[,<span class="dv">3</span><span class="op">:</span><span class="kw">ncol</span>(dwide)])</a>
<a class="sourceLine" id="cb207-2" data-line-number="2"></a>
<a class="sourceLine" id="cb207-3" data-line-number="3">df_out &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(delay_pca<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb207-4" data-line-number="4">df_out &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(dwide <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(line, station_clean), df_out)</a>
<a class="sourceLine" id="cb207-5" data-line-number="5"><span class="kw">head</span>(df_out)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 40
## # Groups:   line, station_clean [6]
##   line  station_clean    PC1     PC2    PC3    PC4    PC5      PC6   PC7   PC8
##   &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 BD    BATHURST        6.50   26.9   -2.71 -10.8  -8.40  -11.7    -3.33 -4.11
## 2 BD    BAY            24.8     7.63  -2.19  -7.05  0.714   3.90   -2.29 -4.14
## 3 BD    BLOOR         -62.4  -112.    57.3  -23.4  -5.09  -14.1    13.7   5.06
## 4 BD    BROADVIEW      -6.60   28.1   -1.06 -14.0  -6.49   -8.29   -6.29 -1.40
## 5 BD    CASTLE         23.8    11.8   -1.31  -7.93 -3.62   -3.37   -2.08 -3.48
## 6 BD    CHESTER        24.6    -1.87 -18.6    2.75  1.85    0.0736  3.79 -1.27
## # … with 30 more variables: PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;, PC11 &lt;dbl&gt;, PC12 &lt;dbl&gt;,
## #   PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;, PC16 &lt;dbl&gt;, PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;,
## #   PC19 &lt;dbl&gt;, PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;, PC23 &lt;dbl&gt;, PC24 &lt;dbl&gt;,
## #   PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;, PC28 &lt;dbl&gt;, PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;,
## #   PC31 &lt;dbl&gt;, PC32 &lt;dbl&gt;, PC33 &lt;dbl&gt;, PC34 &lt;dbl&gt;, PC35 &lt;dbl&gt;, PC36 &lt;dbl&gt;,
## #   PC37 &lt;dbl&gt;, PC38 &lt;dbl&gt;</code></pre>
<p>Plot the first two PCs, and label some outlying stations:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1"><span class="kw">ggplot</span>(df_out,<span class="kw">aes</span>(<span class="dt">x=</span>PC1,<span class="dt">y=</span>PC2,<span class="dt">color=</span>line )) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_repel</span>(<span class="dt">data =</span> df_out <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(PC2<span class="op">&gt;</span><span class="dv">100</span><span class="op">|</span>PC1<span class="op">&lt;</span><span class="dv">100</span><span class="op">*-</span><span class="dv">1</span>), <span class="kw">aes</span>(<span class="dt">label =</span> station_clean))</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-103-1.png" width="672" /></p>
<p>Plot the factor loadings. Some evidence of public v operator?</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">df_out_r &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(delay_pca<span class="op">$</span>rotation)</a>
<a class="sourceLine" id="cb210-2" data-line-number="2">df_out_r<span class="op">$</span>feature &lt;-<span class="st"> </span><span class="kw">colnames</span>(dwide[,<span class="dv">3</span><span class="op">:</span><span class="kw">ncol</span>(dwide)])</a>
<a class="sourceLine" id="cb210-3" data-line-number="3"></a>
<a class="sourceLine" id="cb210-4" data-line-number="4">df_out_r</a></code></pre></div>
<pre><code>## # A tibble: 38 x 39
##         PC1      PC2      PC3      PC4      PC5      PC6      PC7     PC8
##       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 -0.0412   0.0638   1.33e-2 -4.67e-2  0.0246   0.0184  -0.00363  0.0198
##  2 -0.0332  -0.00469 -4.14e-2 -7.51e-3  0.0201  -0.0122  -0.0914  -0.0903
##  3 -0.135    0.207    2.37e-2 -1.44e-1  0.135   -0.0381  -0.00931 -0.320 
##  4 -0.0652   0.0475  -4.43e-2 -2.51e-2 -0.00139 -0.0748  -0.144   -0.428 
##  5 -0.00443  0.00878 -4.99e-5 -8.30e-4  0.00967  0.00954 -0.0160  -0.0144
##  6 -0.0268  -0.00722 -4.39e-3  5.34e-4 -0.0151  -0.0125  -0.00381 -0.0423
##  7 -0.0813   0.0960  -4.62e-2  4.79e-2 -0.0978  -0.0365  -0.0766   0.278 
##  8 -0.0117   0.0135   5.48e-3 -2.94e-2  0.0125   0.0377  -0.0790  -0.0321
##  9 -0.516    0.655   -1.77e-2 -1.62e-1 -0.221   -0.287   -0.184    0.0465
## 10 -0.151    0.0826   5.48e-2  3.52e-1 -0.397    0.281    0.110    0.477 
## # … with 28 more rows, and 31 more variables: PC9 &lt;dbl&gt;, PC10 &lt;dbl&gt;,
## #   PC11 &lt;dbl&gt;, PC12 &lt;dbl&gt;, PC13 &lt;dbl&gt;, PC14 &lt;dbl&gt;, PC15 &lt;dbl&gt;, PC16 &lt;dbl&gt;,
## #   PC17 &lt;dbl&gt;, PC18 &lt;dbl&gt;, PC19 &lt;dbl&gt;, PC20 &lt;dbl&gt;, PC21 &lt;dbl&gt;, PC22 &lt;dbl&gt;,
## #   PC23 &lt;dbl&gt;, PC24 &lt;dbl&gt;, PC25 &lt;dbl&gt;, PC26 &lt;dbl&gt;, PC27 &lt;dbl&gt;, PC28 &lt;dbl&gt;,
## #   PC29 &lt;dbl&gt;, PC30 &lt;dbl&gt;, PC31 &lt;dbl&gt;, PC32 &lt;dbl&gt;, PC33 &lt;dbl&gt;, PC34 &lt;dbl&gt;,
## #   PC35 &lt;dbl&gt;, PC36 &lt;dbl&gt;, PC37 &lt;dbl&gt;, PC38 &lt;dbl&gt;, feature &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1"><span class="kw">ggplot</span>(df_out_r,<span class="kw">aes</span>(<span class="dt">x=</span>PC1,<span class="dt">y=</span>PC2,<span class="dt">label=</span>feature )) <span class="op">+</span><span class="st"> </span><span class="kw">geom_text_repel</span>()</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
</div>
</div>
<div id="exercises" class="section level2">
<h2><span class="header-section-number">18.6</span> Exercises</h2>
<ol style="list-style-type: decimal">
<li>Using the <code>opendatatoronto</code> package, download the data on mayoral campaign contributions for 2014. (note: the 2014 file you will get from <code>get_resource</code>, so just keep the sheet that relates to the Mayor election).</li>
<li>Clean up the data format (fixing the parsing issue and standardizing the column names using <code>janitor</code>)</li>
<li>Summarize the variables in the dataset. Are there missing values, and if so, should we be worried about them? Is every variable in the format it should be? If not, create new variable(s) that are in the right format.</li>
<li>Visually explore the distribution of values of the contributions. What contributions are notable outliers? Do they share a similar characteristic(s)? It may be useful to plot the distribution of contributions without these outliers to get a better sense of the majority of the data.</li>
<li>List the top five candidates in each of these categories:
<ul>
<li>total contributions</li>
<li>mean contribution</li>
<li>number of contributions</li>
</ul></li>
<li>Repeat 5 but without contributions from the candidates themselves.</li>
<li>How many contributors gave money to more than one candidate?</li>
</ol>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="lab-ggplot2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="case-study-historical-canadian-elections.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
