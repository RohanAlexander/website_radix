<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>25 Matching &amp; difference-in-differences | Telling Stories with Data</title>
  <meta name="description" content="25 Matching &amp; difference-in-differences | Telling Stories with Data" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="25 Matching &amp; difference-in-differences | Telling Stories with Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="25 Matching &amp; difference-in-differences | Telling Stories with Data" />
  
  
  

<meta name="author" content="Rohan Alexander" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ab-testing-and-rcts.html"/>
<link rel="next" href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i><b>1</b> Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="overview.html"><a href="overview.html#on-telling-stories"><i class="fa fa-check"></i><b>1.1</b> On telling stories</a></li>
<li class="chapter" data-level="1.2" data-path="overview.html"><a href="overview.html#telling-stories-with-data"><i class="fa fa-check"></i><b>1.2</b> Telling stories with data</a></li>
<li class="chapter" data-level="1.3" data-path="overview.html"><a href="overview.html#these-notes"><i class="fa fa-check"></i><b>1.3</b> These notes</a><ul>
<li class="chapter" data-level="1.3.1" data-path="overview.html"><a href="overview.html#software"><i class="fa fa-check"></i><b>1.3.1</b> Software</a></li>
<li class="chapter" data-level="1.3.2" data-path="overview.html"><a href="overview.html#assumed-background"><i class="fa fa-check"></i><b>1.3.2</b> Assumed background</a></li>
<li class="chapter" data-level="1.3.3" data-path="overview.html"><a href="overview.html#structure"><i class="fa fa-check"></i><b>1.3.3</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="overview.html"><a href="overview.html#acknowledgements"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.5" data-path="overview.html"><a href="overview.html#contact"><i class="fa fa-check"></i><b>1.5</b> Contact</a></li>
<li class="chapter" data-level="1.6" data-path="overview.html"><a href="overview.html#todos"><i class="fa fa-check"></i><b>1.6</b> TODOs</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab-getting-started.html"><a href="lab-getting-started.html"><i class="fa fa-check"></i><b>2</b> Lab - Getting started</a><ul>
<li class="chapter" data-level="2.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#tidyverse"><i class="fa fa-check"></i><b>2.2</b> Tidyverse</a><ul>
<li class="chapter" data-level="2.2.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#the-pipe"><i class="fa fa-check"></i><b>2.2.1</b> The pipe</a></li>
<li class="chapter" data-level="2.2.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#select"><i class="fa fa-check"></i><b>2.2.2</b> Select</a></li>
<li class="chapter" data-level="2.2.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#filter"><i class="fa fa-check"></i><b>2.2.3</b> Filter</a></li>
<li class="chapter" data-level="2.2.4" data-path="lab-getting-started.html"><a href="lab-getting-started.html#arrange"><i class="fa fa-check"></i><b>2.2.4</b> Arrange</a></li>
<li class="chapter" data-level="2.2.5" data-path="lab-getting-started.html"><a href="lab-getting-started.html#group_by"><i class="fa fa-check"></i><b>2.2.5</b> group_by</a></li>
<li class="chapter" data-level="2.2.6" data-path="lab-getting-started.html"><a href="lab-getting-started.html#mutate"><i class="fa fa-check"></i><b>2.2.6</b> Mutate</a></li>
<li class="chapter" data-level="2.2.7" data-path="lab-getting-started.html"><a href="lab-getting-started.html#summarise"><i class="fa fa-check"></i><b>2.2.7</b> Summarise</a></li>
<li class="chapter" data-level="2.2.8" data-path="lab-getting-started.html"><a href="lab-getting-started.html#counting-by-group"><i class="fa fa-check"></i><b>2.2.8</b> Counting by group</a></li>
<li class="chapter" data-level="2.2.9" data-path="lab-getting-started.html"><a href="lab-getting-started.html#calculate-proportions"><i class="fa fa-check"></i><b>2.2.9</b> Calculate proportions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#ggplot"><i class="fa fa-check"></i><b>2.3</b> ggplot</a><ul>
<li class="chapter" data-level="2.3.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#main-features"><i class="fa fa-check"></i><b>2.3.1</b> Main features</a></li>
<li class="chapter" data-level="2.3.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#facets"><i class="fa fa-check"></i><b>2.3.2</b> Facets</a></li>
<li class="chapter" data-level="2.3.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#small-things"><i class="fa fa-check"></i><b>2.3.3</b> Small things</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lab-getting-started.html"><a href="lab-getting-started.html#other"><i class="fa fa-check"></i><b>2.4</b> Other</a><ul>
<li class="chapter" data-level="2.4.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#case_when"><i class="fa fa-check"></i><b>2.4.1</b> case_when</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html"><i class="fa fa-check"></i><b>3</b> Case study - The 2019 Canadian Federal Election</a><ul>
<li class="chapter" data-level="3.1" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#create-a-graph-based-on-the-2019-canadian-federal-election"><i class="fa fa-check"></i><b>3.2</b> Create a graph based on the 2019 Canadian Federal election</a><ul>
<li class="chapter" data-level="3.2.1" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#getting-started"><i class="fa fa-check"></i><b>3.2.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2.2" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#reading-in-the-data"><i class="fa fa-check"></i><b>3.2.2</b> Reading in the data</a></li>
<li class="chapter" data-level="3.2.3" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#clean-the-data"><i class="fa fa-check"></i><b>3.2.3</b> Clean the data</a></li>
<li class="chapter" data-level="3.2.4" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#make-a-graph"><i class="fa fa-check"></i><b>3.2.4</b> Make a graph</a></li>
<li class="chapter" data-level="3.2.5" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#make-a-table"><i class="fa fa-check"></i><b>3.2.5</b> Make a table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>4</b> Communication</a><ul>
<li class="chapter" data-level="4.1" data-path="communication.html"><a href="communication.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="communication.html"><a href="communication.html#title-abstract-and-introduction"><i class="fa fa-check"></i><b>4.2</b> Title, abstract, and introduction</a></li>
<li class="chapter" data-level="4.3" data-path="communication.html"><a href="communication.html#figures-tables-equations-and-technical-terms"><i class="fa fa-check"></i><b>4.3</b> Figures, tables, equations, and technical terms</a></li>
<li class="chapter" data-level="4.4" data-path="communication.html"><a href="communication.html#on-brevity"><i class="fa fa-check"></i><b>4.4</b> On brevity</a></li>
<li class="chapter" data-level="4.5" data-path="communication.html"><a href="communication.html#other-1"><i class="fa fa-check"></i><b>4.5</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html"><i class="fa fa-check"></i><b>5</b> Lab - Using R in practice</a><ul>
<li class="chapter" data-level="5.1" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#getting-help"><i class="fa fa-check"></i><b>5.2</b> Getting help</a></li>
<li class="chapter" data-level="5.3" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#mentality"><i class="fa fa-check"></i><b>5.3</b> Mentality</a></li>
<li class="chapter" data-level="5.4" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#style"><i class="fa fa-check"></i><b>5.4</b> Style</a></li>
<li class="chapter" data-level="5.5" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#learning-more"><i class="fa fa-check"></i><b>5.5</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ethics.html"><a href="ethics.html"><i class="fa fa-check"></i><b>6</b> Ethics</a><ul>
<li class="chapter" data-level="6.1" data-path="ethics.html"><a href="ethics.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ethics.html"><a href="ethics.html#questiontask"><i class="fa fa-check"></i><b>6.2</b> Question/task</a></li>
<li class="chapter" data-level="6.3" data-path="ethics.html"><a href="ethics.html#data"><i class="fa fa-check"></i><b>6.3</b> Data</a></li>
<li class="chapter" data-level="6.4" data-path="ethics.html"><a href="ethics.html#model"><i class="fa fa-check"></i><b>6.4</b> Model</a></li>
<li class="chapter" data-level="6.5" data-path="ethics.html"><a href="ethics.html#team"><i class="fa fa-check"></i><b>6.5</b> Team</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>7</b> Reproducibility</a><ul>
<li class="chapter" data-level="7.1" data-path="reproducibility.html"><a href="reproducibility.html#introduction-5"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="reproducibility.html"><a href="reproducibility.html#data-access"><i class="fa fa-check"></i><b>7.2</b> Data access</a></li>
<li class="chapter" data-level="7.3" data-path="reproducibility.html"><a href="reproducibility.html#on-mistakes"><i class="fa fa-check"></i><b>7.3</b> On mistakes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html"><i class="fa fa-check"></i><b>8</b> Lab - R Markdown and R Projects</a><ul>
<li class="chapter" data-level="8.1" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-markdown"><i class="fa fa-check"></i><b>8.1</b> R Markdown</a><ul>
<li class="chapter" data-level="8.1.1" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#getting-started-1"><i class="fa fa-check"></i><b>8.1.1</b> Getting started</a></li>
<li class="chapter" data-level="8.1.2" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#basic-commands"><i class="fa fa-check"></i><b>8.1.2</b> Basic commands</a></li>
<li class="chapter" data-level="8.1.3" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-chunks"><i class="fa fa-check"></i><b>8.1.3</b> R chunks</a></li>
<li class="chapter" data-level="8.1.4" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#abstracts-and-pdf-outputs"><i class="fa fa-check"></i><b>8.1.4</b> Abstracts and PDF outputs</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-projects"><i class="fa fa-check"></i><b>8.2</b> R projects</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="lab-git-and-docker.html"><a href="lab-git-and-docker.html"><i class="fa fa-check"></i><b>9</b> Lab - Git and Docker</a></li>
<li class="chapter" data-level="10" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html"><i class="fa fa-check"></i><b>10</b> Case study - TTC Subway Delays</a><ul>
<li class="chapter" data-level="10.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#introduction-6"><i class="fa fa-check"></i><b>10.1</b> Introduction</a><ul>
<li class="chapter" data-level="10.1.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#prerequesites"><i class="fa fa-check"></i><b>10.1.1</b> Prerequesites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#finding-and-downloading-data-using-opendatatoronto"><i class="fa fa-check"></i><b>10.2</b> Finding and downloading data using <code>opendatatoronto</code></a><ul>
<li class="chapter" data-level="10.2.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#finding-the-data"><i class="fa fa-check"></i><b>10.2.1</b> Finding the data</a></li>
<li class="chapter" data-level="10.2.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#retrieving-the-data"><i class="fa fa-check"></i><b>10.2.2</b> Retrieving the data</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#plotting"><i class="fa fa-check"></i><b>10.3</b> Plotting</a><ul>
<li class="chapter" data-level="10.3.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#example-1-delays-by-line"><i class="fa fa-check"></i><b>10.3.1</b> Example 1: Delays by line</a></li>
<li class="chapter" data-level="10.3.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#example-2-delays-by-time-of-day"><i class="fa fa-check"></i><b>10.3.2</b> Example 2: Delays by time of day</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="problem-set-1.html"><a href="problem-set-1.html"><i class="fa fa-check"></i><b>11</b> Problem Set 1</a></li>
<li class="chapter" data-level="12" data-path="developing-research-questions.html"><a href="developing-research-questions.html"><i class="fa fa-check"></i><b>12</b> Developing research questions</a><ul>
<li class="chapter" data-level="12.1" data-path="developing-research-questions.html"><a href="developing-research-questions.html#developing-research-questions-1"><i class="fa fa-check"></i><b>12.1</b> Developing research questions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="gathering-data.html"><a href="gathering-data.html"><i class="fa fa-check"></i><b>13</b> Gathering data</a><ul>
<li class="chapter" data-level="13.1" data-path="gathering-data.html"><a href="gathering-data.html#gathering-data-1"><i class="fa fa-check"></i><b>13.1</b> Gathering data</a><ul>
<li class="chapter" data-level="13.1.1" data-path="gathering-data.html"><a href="gathering-data.html#deliberately-available"><i class="fa fa-check"></i><b>13.1.1</b> Deliberately available</a></li>
<li class="chapter" data-level="13.1.2" data-path="gathering-data.html"><a href="gathering-data.html#by-product"><i class="fa fa-check"></i><b>13.1.2</b> By product</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="lab-the-tidyverse.html"><a href="lab-the-tidyverse.html"><i class="fa fa-check"></i><b>14</b> Lab - The Tidyverse</a></li>
<li class="chapter" data-level="15" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html"><i class="fa fa-check"></i><b>15</b> Case study - Gathering and tidying data from Paspaley</a><ul>
<li class="chapter" data-level="15.1" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#introduction-7"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#data-acquisition"><i class="fa fa-check"></i><b>15.2</b> Data acquisition</a></li>
<li class="chapter" data-level="15.3" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#data-cleaning"><i class="fa fa-check"></i><b>15.3</b> Data cleaning</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html"><i class="fa fa-check"></i><b>16</b> Case study - Rohan’s books</a><ul>
<li class="chapter" data-level="16.1" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#introduction-8"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#gather-data"><i class="fa fa-check"></i><b>16.2</b> Gather data</a></li>
<li class="chapter" data-level="16.3" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#data-parsing-and-cleaning"><i class="fa fa-check"></i><b>16.3</b> Data parsing and cleaning</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="lab-ggplot2.html"><a href="lab-ggplot2.html"><i class="fa fa-check"></i><b>17</b> Lab - ggplot2</a></li>
<li class="chapter" data-level="18" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>18</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="18.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-9"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#a-note-on-packages"><i class="fa fa-check"></i><b>18.2</b> A note on packages</a></li>
<li class="chapter" data-level="18.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#ttc-subway-delays"><i class="fa fa-check"></i><b>18.3</b> TTC subway delays</a></li>
<li class="chapter" data-level="18.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#eda-and-data-viz"><i class="fa fa-check"></i><b>18.4</b> EDA and data viz</a></li>
<li class="chapter" data-level="18.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-checks"><i class="fa fa-check"></i><b>18.5</b> Data checks</a><ul>
<li class="chapter" data-level="18.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#sanity-checks"><i class="fa fa-check"></i><b>18.5.1</b> Sanity Checks</a></li>
<li class="chapter" data-level="18.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>18.5.2</b> Missing values</a></li>
<li class="chapter" data-level="18.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#duplicates"><i class="fa fa-check"></i><b>18.5.3</b> Duplicates?</a></li>
<li class="chapter" data-level="18.5.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-distributions"><i class="fa fa-check"></i><b>18.5.4</b> Visualizing distributions</a></li>
<li class="chapter" data-level="18.5.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-time-series"><i class="fa fa-check"></i><b>18.5.5</b> Visualizing time series</a></li>
<li class="chapter" data-level="18.5.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-relationships"><i class="fa fa-check"></i><b>18.5.6</b> Visualizing relationships</a></li>
<li class="chapter" data-level="18.5.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#pca"><i class="fa fa-check"></i><b>18.5.7</b> PCA</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises"><i class="fa fa-check"></i><b>18.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="case-study-historical-canadian-elections.html"><a href="case-study-historical-canadian-elections.html"><i class="fa fa-check"></i><b>19</b> Case study - Historical Canadian elections</a></li>
<li class="chapter" data-level="20" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>20</b> Linear regression</a><ul>
<li class="chapter" data-level="20.1" data-path="linear-regression.html"><a href="linear-regression.html#introduction-10"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="linear-regression.html"><a href="linear-regression.html#competing-relationships"><i class="fa fa-check"></i><b>20.2</b> Competing relationships</a></li>
<li class="chapter" data-level="20.3" data-path="linear-regression.html"><a href="linear-regression.html#implementing-this-in-r"><i class="fa fa-check"></i><b>20.3</b> Implementing this in R</a></li>
<li class="chapter" data-level="20.4" data-path="linear-regression.html"><a href="linear-regression.html#tidy-up-with-broom"><i class="fa fa-check"></i><b>20.4</b> Tidy up with broom</a></li>
<li class="chapter" data-level="20.5" data-path="linear-regression.html"><a href="linear-regression.html#testing-hypothesis"><i class="fa fa-check"></i><b>20.5</b> Testing hypothesis</a></li>
<li class="chapter" data-level="20.6" data-path="linear-regression.html"><a href="linear-regression.html#adding-more-and-varied-explanatory-variables"><i class="fa fa-check"></i><b>20.6</b> Adding more and varied explanatory variables</a></li>
<li class="chapter" data-level="20.7" data-path="linear-regression.html"><a href="linear-regression.html#threats-to-validity-and-aspects-to-think-about"><i class="fa fa-check"></i><b>20.7</b> Threats to validity and aspects to think about</a></li>
<li class="chapter" data-level="20.8" data-path="linear-regression.html"><a href="linear-regression.html#more-credible-outputs"><i class="fa fa-check"></i><b>20.8</b> More credible outputs</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="lab-reporting-regression-results.html"><a href="lab-reporting-regression-results.html"><i class="fa fa-check"></i><b>21</b> Lab - Reporting regression results</a></li>
<li class="chapter" data-level="22" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html"><i class="fa fa-check"></i><b>22</b> Case study - Opinions about a casino in Toronto</a><ul>
<li class="chapter" data-level="22.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#data-preparation"><i class="fa fa-check"></i><b>22.1</b> Data preparation</a><ul>
<li class="chapter" data-level="22.1.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-data-from-opendatatoronto"><i class="fa fa-check"></i><b>22.1.1</b> Getting data from <code>opendatatoronto</code></a></li>
<li class="chapter" data-level="22.1.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-the-right-kind-of-object"><i class="fa fa-check"></i><b>22.1.2</b> Getting the right kind of object</a></li>
<li class="chapter" data-level="22.1.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#cleaning-up-the-dataframe"><i class="fa fa-check"></i><b>22.1.3</b> Cleaning up the dataframe</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#some-visual-exploration-and-more-cleanup-of-course"><i class="fa fa-check"></i><b>22.2</b> Some visual exploration (and more cleanup, of course)</a><ul>
<li class="chapter" data-level="22.2.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-the-data-into-a-more-model-suitable-format"><i class="fa fa-check"></i><b>22.2.1</b> Getting the data into a more model-suitable format</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#logistic-regression"><i class="fa fa-check"></i><b>22.3</b> Logistic Regression</a><ul>
<li class="chapter" data-level="22.3.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#interpretation"><i class="fa fa-check"></i><b>22.3.1</b> Interpretation</a></li>
<li class="chapter" data-level="22.3.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#baseline-category"><i class="fa fa-check"></i><b>22.3.2</b> Baseline category</a></li>
<li class="chapter" data-level="22.3.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#making-estimates"><i class="fa fa-check"></i><b>22.3.3</b> Making estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html"><i class="fa fa-check"></i><b>23</b> Case study - Airbnb listing in Toronto</a><ul>
<li class="chapter" data-level="23.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#essentials"><i class="fa fa-check"></i><b>23.1</b> Essentials</a></li>
<li class="chapter" data-level="23.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#set-up"><i class="fa fa-check"></i><b>23.2</b> Set up</a></li>
<li class="chapter" data-level="23.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#get-data"><i class="fa fa-check"></i><b>23.3</b> Get data</a></li>
<li class="chapter" data-level="23.4" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#clean-data"><i class="fa fa-check"></i><b>23.4</b> Clean data</a><ul>
<li class="chapter" data-level="23.4.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#price"><i class="fa fa-check"></i><b>23.4.1</b> Price</a></li>
<li class="chapter" data-level="23.4.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#superhosts"><i class="fa fa-check"></i><b>23.4.2</b> Superhosts</a></li>
<li class="chapter" data-level="23.4.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#reviews"><i class="fa fa-check"></i><b>23.4.3</b> Reviews</a></li>
<li class="chapter" data-level="23.4.4" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#response-time"><i class="fa fa-check"></i><b>23.4.4</b> Response time</a></li>
<li class="chapter" data-level="23.4.5" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#host-number-of-listings"><i class="fa fa-check"></i><b>23.4.5</b> Host number of listings</a></li>
<li class="chapter" data-level="23.4.6" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#decisions"><i class="fa fa-check"></i><b>23.4.6</b> Decisions</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#explore-data"><i class="fa fa-check"></i><b>23.5</b> Explore data</a><ul>
<li class="chapter" data-level="23.5.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#price-and-reviews"><i class="fa fa-check"></i><b>23.5.1</b> Price and reviews</a></li>
<li class="chapter" data-level="23.5.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#superhost-and-response-time"><i class="fa fa-check"></i><b>23.5.2</b> Superhost and response-time</a></li>
<li class="chapter" data-level="23.5.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#neighbourhood"><i class="fa fa-check"></i><b>23.5.3</b> Neighbourhood</a></li>
</ul></li>
<li class="chapter" data-level="23.6" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#model-data"><i class="fa fa-check"></i><b>23.6</b> Model data</a><ul>
<li class="chapter" data-level="23.6.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#logistic-regression-1"><i class="fa fa-check"></i><b>23.6.1</b> Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="23.7" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#next-steps"><i class="fa fa-check"></i><b>23.7</b> Next steps</a></li>
<li class="chapter" data-level="23.8" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#references"><i class="fa fa-check"></i><b>23.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html"><i class="fa fa-check"></i><b>24</b> A/B testing and RCTs</a><ul>
<li class="chapter" data-level="24.1" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#introduction-11"><i class="fa fa-check"></i><b>24.1</b> Introduction</a></li>
<li class="chapter" data-level="24.2" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#motivation"><i class="fa fa-check"></i><b>24.2</b> Motivation</a></li>
<li class="chapter" data-level="24.3" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#tea-party"><i class="fa fa-check"></i><b>24.3</b> Tea party</a></li>
<li class="chapter" data-level="24.4" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#some-unexpected-properties-from-randomised-sampling"><i class="fa fa-check"></i><b>24.4</b> Some unexpected properties from randomised sampling</a></li>
<li class="chapter" data-level="24.5" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#anova"><i class="fa fa-check"></i><b>24.5</b> ANOVA</a></li>
<li class="chapter" data-level="24.6" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#treatment-and-control"><i class="fa fa-check"></i><b>24.6</b> Treatment and control</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html"><i class="fa fa-check"></i><b>25</b> Matching &amp; difference-in-differences</a><ul>
<li class="chapter" data-level="25.1" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#introduction-12"><i class="fa fa-check"></i><b>25.1</b> Introduction</a></li>
<li class="chapter" data-level="25.2" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#motivation-1"><i class="fa fa-check"></i><b>25.2</b> Motivation</a></li>
<li class="chapter" data-level="25.3" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#example"><i class="fa fa-check"></i><b>25.3</b> Example</a></li>
<li class="chapter" data-level="25.4" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#assumptions"><i class="fa fa-check"></i><b>25.4</b> Assumptions</a></li>
<li class="chapter" data-level="25.5" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#matching"><i class="fa fa-check"></i><b>25.5</b> Matching</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><i class="fa fa-check"></i><b>26</b> Case study - Lower advertising revenue reduced French newspaper prices between 1960 and 1974</a><ul>
<li class="chapter" data-level="26.1" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#introduction-13"><i class="fa fa-check"></i><b>26.1</b> Introduction</a></li>
<li class="chapter" data-level="26.2" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#background"><i class="fa fa-check"></i><b>26.2</b> Background</a></li>
<li class="chapter" data-level="26.3" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#data-1"><i class="fa fa-check"></i><b>26.3</b> Data</a></li>
<li class="chapter" data-level="26.4" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#model-1"><i class="fa fa-check"></i><b>26.4</b> Model</a></li>
<li class="chapter" data-level="26.5" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#results"><i class="fa fa-check"></i><b>26.5</b> Results</a></li>
<li class="chapter" data-level="26.6" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#other-points"><i class="fa fa-check"></i><b>26.6</b> Other points</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="shiny-applications.html"><a href="shiny-applications.html"><i class="fa fa-check"></i><b>27</b> Shiny applications</a></li>
<li class="chapter" data-level="28" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html"><i class="fa fa-check"></i><b>28</b> Regression discontinuity design</a></li>
<li class="chapter" data-level="29" data-path="introduction-14.html"><a href="introduction-14.html"><i class="fa fa-check"></i><b>29</b> Introduction</a></li>
<li class="chapter" data-level="30" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>30</b> Instrumental variables</a></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telling Stories with Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="matching-difference-in-differences" class="section level1">
<h1><span class="header-section-number">25</span> Matching &amp; difference-in-differences</h1>
<p><strong>Required reading</strong></p>
<ul>
<li>Gertler, Paul, Sebastian Martinez, Patrick Premand, Laura Rawlings, and Christel Vermeersch, ‘Impact Evaluation in Practice’, Chapters 7 and 8.</li>
</ul>
<p><strong>Recommended reading</strong></p>
<ul>
<li>Alexander, Monica, Polimis, Kivan, and Zagheni, Emilio, 2019,’ The impact of Hurricane Maria on out-migration from Puerto Rico: Evidence from Facebook data’, <em>Population and Development Review</em>. (Example of using diff-in-diff to measure the effect of Hurricane Maria.)</li>
<li>Alexander, Rohan, and Zachary Ward, 2018, ‘Age at arrival and assimilation during the age of mass migration’, <em>The Journal of Economic History</em>, 78, no. 3, 904-937. (Example where I used differences between brothers to estimate the effect of education.)</li>
<li>Austin, Peter C., 2011, ‘An Introduction to Propensity Score Methods for Reducing the Effects of Confounding in Observational Studies’, <em>Multivariate Behavioral Research</em>, vol. 46, no. 3, pp.399-424. (Broad overview of propensity score matching, with a nice discussion of the comparison to randomised controlled trials.)</li>
<li>Cunningham, Scott, <em>Causal Inference: The Mixtape</em>, chapters ‘Matching and subclassifications’ and ‘Differences-in-differences’, freely available at: <a href="http://scunning.com/cunningham_mixtape.pdf" class="uri">http://scunning.com/cunningham_mixtape.pdf</a>. (Very well-written notes on diff-in-diff.)</li>
<li>King, Gary, and Richard Nielsen, 2019, ‘Why Propensity Scores Should Not Be Used for Matching’, <em>Political Analysis</em>. (Academic paper on the limits of propensity score matching. Propensity score matching was a big thing in the 90s but everyone knew about these weaknesses and so it died off. Lately, there has been a resurgence because of machine learning people using it without thinking so King and Nielsen wrote a nice paper about its flaws.)</li>
<li>Saeed, Sahar, Erica E. M. Moodie, Erin C. Strumpf, Marina B. Klein, 2019, ‘Evaluating the impact of health policies: using a difference-in-differences approach’, <em>International Journal of Public Health</em>, 64, pp. 637–642, <a href="https://doi.org/10.1007/s00038-018-1195-2" class="uri">https://doi.org/10.1007/s00038-018-1195-2</a>.</li>
<li>Taddy, Matt, 2019, <em>Business Data Science</em>, Chapter 5. (Some brief notes on diff-in-diff that may appeal to some students.)</li>
<li>Tang, John, 2015, ‘Pollution havens and the trade in toxic chemicals: evidence from U.S. trade flows’, <em>Ecological Economics</em>, vol. 112, pp. 150-160. (Example of using diff-in-diff to estimate pollution.)</li>
</ul>
<p><strong>Key concepts/skills/etc</strong></p>
<ul>
<li>Essential matching methods.</li>
<li>Weaknesses of matching.</li>
<li>Difference-in-differences.</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>broom</code></li>
<li><code>tidyverse</code></li>
</ul>
<p><strong>Key functions/etc</strong></p>
<ul>
<li><code>tidy()</code></li>
<li><code>lm()</code></li>
</ul>
<p><strong>Pre-quiz</strong></p>
<ol style="list-style-type: decimal">
<li>Sharla Gelfand has been ‘(s)haring two #rstats functions most days - one I know and love, and one that’s new to me!’. Please go to Sharla’s GitHub page: <a href="https://github.com/sharlagelfand/twofunctionsmostdays" class="uri">https://github.com/sharlagelfand/twofunctionsmostdays</a>. Please find a package that she mentions that you have never used. Please find the relevant website for the package. Please describe what the package does and a context in which it could be useful to you.</li>
<li>Sharla Gelfand has been ‘(s)haring two #rstats functions most days - one I know and love, and one that’s new to me!’. Please go to Sharla’s GitHub page: <a href="https://github.com/sharlagelfand/twofunctionsmostdays" class="uri">https://github.com/sharlagelfand/twofunctionsmostdays</a>. Please find a function that she mentions that you have never used. Please look at the help file for that function. Please detail the arguments of the function, and a context in which it could be useful to you.</li>
<li>What is propensity score matching? If you were matching people, then what are some of the features that you would like to match on? What sort of ethical questions does collecting and storing such information raise for you?</li>
<li>Putting to one side, the ethical issues, what are some statistical weaknesses with propensity score matching?</li>
<li>What is the key assumption when using diff-in-diff?</li>
<li>Please read the fascinating article in The Markup about car insurance algorithms: <a href="https://themarkup.org/allstates-algorithm/2020/02/25/car-insurance-suckers-list" class="uri">https://themarkup.org/allstates-algorithm/2020/02/25/car-insurance-suckers-list</a>. Please read the article and tell me what you think. You may wish to focus on ethical, legal, social, statistical, or other, aspects.</li>
<li>Please go to the GitHub page related to the fascinating article in The Markup about car insurance algorithms: <a href="https://github.com/the-markup/investigation-allstates-algorithm" class="uri">https://github.com/the-markup/investigation-allstates-algorithm</a>. What is great about their work? What could be improved?</li>
</ol>
<div id="introduction-12" class="section level2">
<h2><span class="header-section-number">25.1</span> Introduction</h2>
<p>The ideal situation, as described in the previous chapter, is rarely possible in a data science setting. Can we really reasonably expect that Netflix would allow us to change prices. And even if they did once, would they let us do it again, and again, and again? Further, rarely can we explicitly create treatment and control groups. Finally, experiments are really expensive and potentially unethical. Instead, we need to make do with what we have. Rather than our counterfactual coming to us through randomisation, and hence us knowing that the two are the same but for the treatment, we try to identify groups that were similar before the treatment, and hence any differences can be attributed to the treatment. In practice, we tend to even have differences between our two groups before we treat. Provided those pre-treatment differences satisfy some assumptions (basically that they were consistent, and we expect that consistency to continue in the absence of the treatment) – the ‘parallel trends’ assumption – then we can look to any difference in the differences as the effect of the treatment. One of the lovely aspects of difference in differences analysis is that we can do it using fairly straight-forward quantitative methods - linear regression with a dummy variable is all that is needed to do a convincing job.</p>
</div>
<div id="motivation-1" class="section level2">
<h2><span class="header-section-number">25.2</span> Motivation</h2>
<p>Consider us wanting to know the effect of a new tennis racket on serve speed. One way to test this would be to measure the difference between Roger Federer’s serve speed without the tennis racket and mine with the tennis racket. Sure, we’d find a difference but how do we know how much to attribute to the tennis racket? Another way would be to consider the difference between my serve speed without the tennis racket and my serve speed with the tennis racket. But what if serves were just getting faster naturally over time? Instead, let’s combine the two to look at the difference in the differences!</p>
<p>In this world we measure Federer’s serve and compare it to my serve without the new racket. We then measure Federer’s serve again and measure my serve with the new racket. That difference in the differences would then be our estimate of the effect of the new racket.</p>
<p>What sorts of assumptions jump out at you that we are going to have to make in order for this analysis to be appropriate?</p>
<ol style="list-style-type: decimal">
<li>Is there something else that may have affected only me, and not Roger that could affect my serve speed? Probably.
e2) Is it likely that Roger Federer and I have the same trajectory of serve speed improvement? Probably not. This is the ‘parallel trends’ assumption, and it dominates any discussion of difference in differences analysis. Finally, is it likely that the variance of our serve speeds is the same? Probably not.</li>
</ol>
<p>Why might this be powerful? We don’t need the treatment and control group to be the same before the treatment. We just need to have a good idea of how they differ.</p>
</div>
<div id="example" class="section level2">
<h2><span class="header-section-number">25.3</span> Example</h2>
<p>Let’s generate some data.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb360-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb360-3" data-line-number="3"></a>
<a class="sourceLine" id="cb360-4" data-line-number="4"><span class="kw">set.seed</span>(<span class="dv">853</span>)</a>
<a class="sourceLine" id="cb360-5" data-line-number="5"></a>
<a class="sourceLine" id="cb360-6" data-line-number="6">diff_in_diff_example_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">person =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>), <span class="dt">times =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb360-7" data-line-number="7">                       <span class="dt">time =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>, <span class="dt">times =</span> <span class="dv">1000</span>), <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dt">times =</span> <span class="dv">1000</span>)),</a>
<a class="sourceLine" id="cb360-8" data-line-number="8">                       <span class="dt">treatment_group =</span> <span class="kw">rep</span>(<span class="kw">sample</span>(<span class="dt">x =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size  =</span> <span class="dv">1000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">times =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb360-9" data-line-number="9">                       )</a>
<a class="sourceLine" id="cb360-10" data-line-number="10"><span class="co"># We want to make the outcome slightly more likely if they were treated than if not.</span></a>
<a class="sourceLine" id="cb360-11" data-line-number="11">diff_in_diff_example_data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb360-12" data-line-number="12"><span class="st">  </span>diff_in_diff_example_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb360-13" data-line-number="13"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb360-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">serve_speed =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb360-15" data-line-number="15">    time <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>treatment_group <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb360-16" data-line-number="16">    time <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>treatment_group <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">6</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb360-17" data-line-number="17">    time <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>treatment_group <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">8</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb360-18" data-line-number="18">    time <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>treatment_group <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">mean =</span> <span class="dv">14</span>, <span class="dt">sd =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb360-19" data-line-number="19">    )</a>
<a class="sourceLine" id="cb360-20" data-line-number="20">    )</a></code></pre></div>
<p>Let’s make a graph.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1">diff_in_diff_example_data<span class="op">$</span>treatment_group &lt;-<span class="st"> </span><span class="kw">as.factor</span>(diff_in_diff_example_data<span class="op">$</span>treatment_group)</a>
<a class="sourceLine" id="cb361-2" data-line-number="2">diff_in_diff_example_data<span class="op">$</span>time &lt;-<span class="st"> </span><span class="kw">as.factor</span>(diff_in_diff_example_data<span class="op">$</span>time)</a>
<a class="sourceLine" id="cb361-3" data-line-number="3"></a>
<a class="sourceLine" id="cb361-4" data-line-number="4">diff_in_diff_example_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb361-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time,</a>
<a class="sourceLine" id="cb361-6" data-line-number="6">             <span class="dt">y =</span> serve_speed,</a>
<a class="sourceLine" id="cb361-7" data-line-number="7">             <span class="dt">color =</span> treatment_group)) <span class="op">+</span></a>
<a class="sourceLine" id="cb361-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb361-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> person), <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb361-10" data-line-number="10"><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb361-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time period&quot;</span>,</a>
<a class="sourceLine" id="cb361-12" data-line-number="12">       <span class="dt">y =</span> <span class="st">&quot;Serve speed&quot;</span>,</a>
<a class="sourceLine" id="cb361-13" data-line-number="13">       <span class="dt">color =</span> <span class="st">&quot;Person got a new racket&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb361-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Set1&quot;</span>)</a></code></pre></div>
<p><img src="notes_files/figure-html/unnamed-chunk-202-1.png" width="672" /></p>
<p>As it is a simple example, we could also do this manually, by getting the average difference of the differences.</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb362-1" data-line-number="1">average_differences &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb362-2" data-line-number="2"><span class="st">  </span>diff_in_diff_example_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb362-3" data-line-number="3"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> time,</a>
<a class="sourceLine" id="cb362-4" data-line-number="4">              <span class="dt">values_from =</span> serve_speed,</a>
<a class="sourceLine" id="cb362-5" data-line-number="5">              <span class="dt">names_prefix =</span> <span class="st">&quot;time_&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb362-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">difference =</span> time_<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>time_<span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb362-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(treatment_group) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb362-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">average_difference =</span> <span class="kw">mean</span>(difference))</a>
<a class="sourceLine" id="cb362-9" data-line-number="9"></a>
<a class="sourceLine" id="cb362-10" data-line-number="10">average_differences<span class="op">$</span>average_difference[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>average_differences<span class="op">$</span>average_difference[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## [1] 5.058414</code></pre>
<p>Let’s use OLS to do the same analysis. The general regression equation is:
<span class="math display">\[Y_{i,t} = \beta_0 + \beta_1\mbox{Treatment group dummy}_i + \beta_2\mbox{Time dummy}_t + \beta_3(\mbox{Treatment group dummy} \times\mbox{Time dummy})_{i,t} + \epsilon_{i,t}\]</span></p>
<p>If we use <code>*</code> in the regression then it automatically includes the separate aspects as well as their interaction. It’s the estimate of <span class="math inline">\(\beta_3\)</span> which is of interest.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" data-line-number="1">diff_in_diff_example_regression &lt;-<span class="st"> </span><span class="kw">lm</span>(serve_speed <span class="op">~</span><span class="st"> </span>treatment_group<span class="op">*</span>time, </a>
<a class="sourceLine" id="cb364-2" data-line-number="2">                         <span class="dt">data =</span> diff_in_diff_example_data)</a>
<a class="sourceLine" id="cb364-3" data-line-number="3"></a>
<a class="sourceLine" id="cb364-4" data-line-number="4"><span class="kw">tidy</span>(diff_in_diff_example_regression)</a></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; margin-bottom: 2em; margin-top: 2em; width: 100%; margin-left: 0%; margin-right: auto;  ">
<col><col><col><col><col><tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0.4pt; padding: 4pt 4pt 4pt 4pt; font-weight: bold;">term</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt; font-weight: bold;">estimate</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt; font-weight: bold;">std.error</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.4pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt; font-weight: bold;">statistic</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.4pt 0.4pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt; font-weight: bold;">p.value</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">(Intercept)</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">4.97</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">0.0428</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">116&nbsp;&nbsp;</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt; padding: 4pt 4pt 4pt 4pt;">treatment_group1</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt;">3.03</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt;">0.0622</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt;">48.7</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt; padding: 4pt 4pt 4pt 4pt;">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0pt 0.4pt; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">time1</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">1.01</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">0.0605</td>
<td style="vertical-align: top; text-align: right; white-space: normal; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">16.6</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0pt 0pt; padding: 4pt 4pt 4pt 4pt; background-color: rgb(242, 242, 242);">2.97e-58</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0.4pt; padding: 4pt 4pt 4pt 4pt;">treatment_group1:time1</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt;">5.06</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt;">0.088&nbsp;</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt;">57.5</td>
<td style="vertical-align: top; text-align: right; white-space: normal; border-style: solid solid solid solid; border-width: 0pt 0.4pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt;">0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
</table>

<p>Fortunately, our estimates are the same!</p>
</div>
<div id="assumptions" class="section level2">
<h2><span class="header-section-number">25.4</span> Assumptions</h2>
<p>If we want to use difference in differences, then we need to satisfy the assumptions. There were three that were touched on earlier, but here I want to focus on one: the ‘parallel trends’ assumption. The parallel trends assumption haunts everything to do with diff-in-diff analysis because we can never prove it, we can just be convinced of it.</p>
<p>To see why we can never prove it, consider an example in which we want to know the effect of a new stadium on a professional sports team’s wins/loses. To do this we consider two teams: the Warriors and the Raptors. The Warriors changed stadiums at the start of the 2019-20 season (the Raptors did not), so we will consider four time periods: the 2016-17 season, 2017-18 season, 2018-19 season, and finally we will compare the performance with the one after they moved, so in the 2019-20 season. The Raptors here act as our counterfactual. This means that we assume the relationship between the Warriors and the Raptors, in the absence of a new stadium, would have continued to change in a consistent way. But we can never know that for certain. We have to present sufficient evidence to assuage any concerns that a reader may have.</p>
<p>For a variety of reasons, it is worth having tougher than normal requirements around the evidence it would take to convince you of an effect.</p>
<p>There are four main ‘threats to validity’ when you are using difference in differences and you should address all of these (Cunningham, 2020, pp. 272–277):</p>
<ol style="list-style-type: decimal">
<li>Non-parallel trends. The treatment and control groups may be based on differences. As such it can be difficult to convincingly argue for parallel trends. In this case, maybe try to find another factor to consider in your model that may adjust for some of that. This may require difference in difference in differences (in the earlier example, perhaps could add in the San Francisco 49ers as they are in the same broad geographic area as the Warriors). Or maybe re-think your analysis to see if you can make a different control group. Adding additional earlier time periods may help but may introduce more issues (see third point).</li>
<li>Compositional differences. This is a concern when working with repeated cross-sections. What if the composition of those cross-sections change? For instance, if we work at Tik Tok or some other app that is rapidly growing and want to look at the effect of some change. In our initial cross-section, we may have mostly young people, but in a subsequent cross-section, we may have more older people as the demographics of the app usage change. Hence our results may just be an age-effect, not an effect of the change that we are interested in.</li>
<li>Long-term effects vs. reliability. As we discussed in the last chapter, there is a trade-off between the length of the analysis that we run. As we run the analysis for longer there is more opportunity for other factors to affect the results. There is also increased chance for someone who was not treated to be treated. But, on the other hand, it can be difficult to convincingly argue that short-term results will continue in the long-term.</li>
<li>Functional form dependence. This is less of an issue when the outcomes are similar, but if they are different then functional form may be responsible for some aspects of the results.</li>
</ol>
</div>
<div id="matching" class="section level2">
<h2><span class="header-section-number">25.5</span> Matching</h2>
<p><em>This section draws on material from Gelman and Hill, 2007, pp. 207 - 212.</em></p>
<p>Difference in differences is a powerful analysis framework. After I learnt about it I began to see opportunities to implement it everywhere. But it can be tough to identify appropriate treatment and control groups. In Alexander and Ward, 2018, we compare migrant brothers - one of whom had most of their education in a different country, and the other who had most of their education in the US. Is this really the best match?</p>
<p>We may be able to match based on observable variables. For instance, age-group or education. At two different times we compare smoking rates in 18-year-olds in one city with smoking rates in 18-year-olds in another city. That is fine, but it is fairly coarse. We know that there are differences between 18-year-olds, even in terms of the variables that we commonly observe, say gender and education. One way to deal with this may be to create sub-groups: 18-year-old males with a high school education, etc. But the sample sizes are likely to quickly become small. How do we deal with continuous variables? And also, is the difference between an 18-year-old and a 19-year-old really so different? Shouldn’t we also compare with them?</p>
<p>One way to proceed is to consider a nearest neighbour approach. But there is limited concern for uncertainty in this approach. There is also an issue if you have a large number of variables because you end up with a high-dimension graph. This leads us to propensity score matching.</p>
<p>Propensity score matching involves assigning some probability to each observation. We construct that probability based on the observation’s values for the independent variables, at their values before the treatment. That probability is our best guess at the probability of the observation being treated, regardless of whether it was treated or not. For instance, if 18-year-old males were treated but 19-year-old males were not, then as there is not much difference between 18-year-old males and 19-year-old males our assigned probability would be fairly similar. We can then compare the outcomes of observations with similar propensity scores.</p>
<p>One advantage of propensity score matching is that is allows us to easily consider many independent variables at once, and it can be constructed using logistic regression.</p>
<p>Let’s generate some data to illustrate propensity score matching. Let’s pretend that we work for Amazon. We are going to treat some individuals with free-shipping to see what happens to their average purchase.</p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb366-1" data-line-number="1">sample_size &lt;-<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb366-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">853</span>)</a>
<a class="sourceLine" id="cb366-3" data-line-number="3"></a>
<a class="sourceLine" id="cb366-4" data-line-number="4">amazon_purchase_data &lt;-</a>
<a class="sourceLine" id="cb366-5" data-line-number="5"><span class="st">  </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb366-6" data-line-number="6">    <span class="dt">unique_person_id =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>sample_size),</a>
<a class="sourceLine" id="cb366-7" data-line-number="7">    <span class="dt">age =</span> <span class="kw">runif</span>(<span class="dt">n =</span> sample_size,</a>
<a class="sourceLine" id="cb366-8" data-line-number="8">                <span class="dt">min =</span> <span class="dv">18</span>,</a>
<a class="sourceLine" id="cb366-9" data-line-number="9">                <span class="dt">max =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb366-10" data-line-number="10">    <span class="dt">city =</span> <span class="kw">sample</span>(</a>
<a class="sourceLine" id="cb366-11" data-line-number="11">      <span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;Toronto&quot;</span>, <span class="st">&quot;Montreal&quot;</span>, <span class="st">&quot;Calgary&quot;</span>),</a>
<a class="sourceLine" id="cb366-12" data-line-number="12">      <span class="dt">size =</span> sample_size,</a>
<a class="sourceLine" id="cb366-13" data-line-number="13">      <span class="dt">replace =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb366-14" data-line-number="14">      ),</a>
<a class="sourceLine" id="cb366-15" data-line-number="15">    <span class="dt">gender =</span> <span class="kw">sample</span>(</a>
<a class="sourceLine" id="cb366-16" data-line-number="16">      <span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Other/decline&quot;</span>),</a>
<a class="sourceLine" id="cb366-17" data-line-number="17">      <span class="dt">size =</span> sample_size,</a>
<a class="sourceLine" id="cb366-18" data-line-number="18">      <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb366-19" data-line-number="19">      <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.49</span>, <span class="fl">0.47</span>, <span class="fl">0.02</span>)</a>
<a class="sourceLine" id="cb366-20" data-line-number="20">      ),</a>
<a class="sourceLine" id="cb366-21" data-line-number="21">    <span class="dt">income =</span> <span class="kw">rlnorm</span>(<span class="dt">n =</span> sample_size,</a>
<a class="sourceLine" id="cb366-22" data-line-number="22">                    <span class="dt">meanlog =</span> <span class="fl">0.5</span>, </a>
<a class="sourceLine" id="cb366-23" data-line-number="23">                    <span class="dt">sdlog =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb366-24" data-line-number="24">    )</a></code></pre></div>
<p>Now we need to add some probability of being treated with free shipping, which depends on our variables. Younger, higher-income, male and in Toronto all make it slightly more likely.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" data-line-number="1">amazon_purchase_data &lt;-</a>
<a class="sourceLine" id="cb367-2" data-line-number="2"><span class="st">  </span>amazon_purchase_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb367-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_num =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb367-4" data-line-number="4">           age <span class="op">&lt;</span><span class="st"> </span><span class="dv">30</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb367-5" data-line-number="5">           age <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb367-6" data-line-number="6">           age <span class="op">&lt;</span><span class="st"> </span><span class="dv">70</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb367-7" data-line-number="7">           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb367-8" data-line-number="8">         <span class="dt">city_num =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb367-9" data-line-number="9">           city <span class="op">==</span><span class="st"> &quot;Toronto&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb367-10" data-line-number="10">           city <span class="op">==</span><span class="st"> &quot;Montreal&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb367-11" data-line-number="11">           city <span class="op">==</span><span class="st"> &quot;Calgary&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb367-12" data-line-number="12">           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb367-13" data-line-number="13">         <span class="dt">gender_num =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb367-14" data-line-number="14">           gender <span class="op">==</span><span class="st"> &quot;Male&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb367-15" data-line-number="15">           gender <span class="op">==</span><span class="st"> &quot;Female&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb367-16" data-line-number="16">           gender <span class="op">==</span><span class="st"> &quot;Other/decline&quot;</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb367-17" data-line-number="17">           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb367-18" data-line-number="18">         <span class="dt">income_num =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb367-19" data-line-number="19">           income <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb367-20" data-line-number="20">           income <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb367-21" data-line-number="21">           income <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb367-22" data-line-number="22">           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb367-23" data-line-number="23">         ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb367-24" data-line-number="24"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb367-25" data-line-number="25"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sum_num =</span> <span class="kw">sum</span>(age_num, city_num, gender_num, income_num),</a>
<a class="sourceLine" id="cb367-26" data-line-number="26">         <span class="dt">softmax_prob =</span> <span class="kw">exp</span>(sum_num)<span class="op">/</span><span class="kw">exp</span>(<span class="dv">12</span>),</a>
<a class="sourceLine" id="cb367-27" data-line-number="27">         <span class="dt">free_shipping =</span> <span class="kw">sample</span>(</a>
<a class="sourceLine" id="cb367-28" data-line-number="28">           <span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb367-29" data-line-number="29">           <span class="dt">size =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb367-30" data-line-number="30">           <span class="dt">replace =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb367-31" data-line-number="31">           <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>softmax_prob, softmax_prob)</a>
<a class="sourceLine" id="cb367-32" data-line-number="32">           )</a>
<a class="sourceLine" id="cb367-33" data-line-number="33">         ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb367-34" data-line-number="34"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb367-35" data-line-number="35"></a>
<a class="sourceLine" id="cb367-36" data-line-number="36">amazon_purchase_data &lt;-</a>
<a class="sourceLine" id="cb367-37" data-line-number="37"><span class="st">  </span>amazon_purchase_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb367-38" data-line-number="38"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>age_num, <span class="op">-</span>city_num, <span class="op">-</span>gender_num, <span class="op">-</span>income_num, <span class="op">-</span>sum_num, <span class="op">-</span>softmax_prob)</a></code></pre></div>
<p>Finally, we need to have some measure of a person’s average spend. We want those with free shipping to be slightly higher than those without.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" data-line-number="1">amazon_purchase_data &lt;-</a>
<a class="sourceLine" id="cb368-2" data-line-number="2"><span class="st">  </span>amazon_purchase_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_spend =</span> <span class="kw">if_else</span>(free_shipping <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">60</span>, <span class="dv">50</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-4" data-line-number="4"><span class="st">  </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">average_spend =</span> <span class="kw">rnorm</span>(<span class="dv">1</span>, mean_spend, <span class="dt">sd =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb368-6" data-line-number="6">    ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-8" data-line-number="8"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>mean_spend)</a>
<a class="sourceLine" id="cb368-9" data-line-number="9"></a>
<a class="sourceLine" id="cb368-10" data-line-number="10"><span class="co"># Fix the class on some</span></a>
<a class="sourceLine" id="cb368-11" data-line-number="11">amazon_purchase_data &lt;-</a>
<a class="sourceLine" id="cb368-12" data-line-number="12"><span class="st">  </span>amazon_purchase_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb368-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(city, gender, free_shipping), <span class="op">~</span><span class="kw">as.factor</span>(.)) <span class="co"># Change some to factors</span></a></code></pre></div>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1"><span class="kw">table</span>(amazon_purchase_data<span class="op">$</span>free_shipping)</a></code></pre></div>
<pre><code>## 
##    0    1 
## 9629  371</code></pre>
<p>Now we construct a logistic regression model that ‘explains’ whether a person was treated as a function of the variables that we think explain it.</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1">propensity_score &lt;-<span class="st"> </span><span class="kw">glm</span>(free_shipping <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>city <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>income, </a>
<a class="sourceLine" id="cb371-2" data-line-number="2">                        <span class="dt">family =</span> binomial,</a>
<a class="sourceLine" id="cb371-3" data-line-number="3">                        <span class="dt">data =</span> amazon_purchase_data)</a></code></pre></div>
<p>We will now add our forecast to our dataset.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb372-1" data-line-number="1">amazon_purchase_data &lt;-<span class="st"> </span><span class="kw">augment</span>(propensity_score, </a>
<a class="sourceLine" id="cb372-2" data-line-number="2">                         <span class="dt">data =</span> amazon_purchase_data,</a>
<a class="sourceLine" id="cb372-3" data-line-number="3">                         <span class="dt">type.predict =</span> <span class="st">&quot;response&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb372-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>.se.fit, <span class="op">-</span>.resid, <span class="op">-</span>.hat, <span class="op">-</span>.sigma, <span class="op">-</span>.cooksd, <span class="op">-</span>.std.resid) </a></code></pre></div>
<p>Now we use our forecast to create matches. There are a variety of ways to do this. In a moment I’ll step through some code that does it all at once, but as this is a worked example and we only have a small number of possibilities, we can just do it manually.</p>
<p>For every person who was actually treated (given free shipping) we want the untreated person who was considered as similar to them (based on propensity score) as possible.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1">amazon_purchase_data &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb373-2" data-line-number="2"><span class="st">  </span>amazon_purchase_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb373-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(.fitted, free_shipping)</a></code></pre></div>
<p>Here we’re going to use a matching function from the <code>arm</code> package. This finds which is the closest of the ones that were not treated, to each one that was treated.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" data-line-number="1">amazon_purchase_data<span class="op">$</span>treated &lt;-<span class="st"> </span><span class="kw">if_else</span>(amazon_purchase_data<span class="op">$</span>free_shipping <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb374-2" data-line-number="2">amazon_purchase_data<span class="op">$</span>treated &lt;-<span class="st"> </span><span class="kw">as.integer</span>(amazon_purchase_data<span class="op">$</span>treated)</a>
<a class="sourceLine" id="cb374-3" data-line-number="3"></a>
<a class="sourceLine" id="cb374-4" data-line-number="4">matches &lt;-<span class="st"> </span>arm<span class="op">::</span><span class="kw">matching</span>(<span class="dt">z =</span> amazon_purchase_data<span class="op">$</span>treated, <span class="dt">score =</span> amazon_purchase_data<span class="op">$</span>.fitted)</a>
<a class="sourceLine" id="cb374-5" data-line-number="5"></a>
<a class="sourceLine" id="cb374-6" data-line-number="6">amazon_purchase_data &lt;-<span class="st"> </span><span class="kw">cbind</span>(amazon_purchase_data, matches)</a></code></pre></div>
<p>Now we reduce the dataset to just those that are matched. We had 371 treated, so we expect a dataset of 742 observations.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1">amazon_purchase_data_matched &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb375-2" data-line-number="2"><span class="st">  </span>amazon_purchase_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb375-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(matched <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb375-4" data-line-number="4"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>matched, <span class="op">-</span>pairs, <span class="op">-</span>treated)</a></code></pre></div>
<p>Finally, we can examine the ‘effect’ of being treated on average spend in the ‘usual’ way.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" data-line-number="1">propensity_score_regression &lt;-<span class="st"> </span><span class="kw">lm</span>(average_spend <span class="op">~</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>city <span class="op">+</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>income <span class="op">+</span><span class="st"> </span>free_shipping, </a>
<a class="sourceLine" id="cb376-2" data-line-number="2">                                  <span class="dt">data =</span> amazon_purchase_data_matched)</a></code></pre></div>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" data-line-number="1">huxtable<span class="op">::</span><span class="kw">huxreg</span>(propensity_score_regression)</a></code></pre></div>
<table class="huxtable" style="border-collapse: collapse; margin-bottom: 2em; margin-top: 2em; width: 50%; margin-left: auto; margin-right: auto;  ">
<col><col><tr>
<td style="vertical-align: top; text-align: center; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0pt 0pt; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: center; white-space: nowrap; border-style: solid solid solid solid; border-width: 0.8pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt;">(1)</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(Intercept)</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">49.694 ***</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(0.809)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">age</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">0.005&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(0.011)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">cityMontreal</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">0.169&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(0.734)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">cityToronto</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">0.652&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(0.623)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">genderMale</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">-0.968 *&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(0.422)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">genderOther/decline</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">-1.973&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(2.621)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">income</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">0.009&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">(0.021)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">free_shipping1</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">10.488 ***</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;"></td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; border-style: solid solid solid solid; border-width: 0pt 0pt 0.4pt 0pt; padding: 4pt 4pt 4pt 4pt;">(0.380)&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">N</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">742&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">R2</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">0.513&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">logLik</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; padding: 4pt 4pt 4pt 4pt;">-2267.486&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td style="vertical-align: top; text-align: left; white-space: nowrap; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt; padding: 4pt 4pt 4pt 4pt;">AIC</td>
<td style="vertical-align: top; text-align: right; white-space: nowrap; border-style: solid solid solid solid; border-width: 0pt 0pt 0.8pt 0pt; padding: 4pt 4pt 4pt 4pt;">4552.971&nbsp;&nbsp;&nbsp;&nbsp;</td>
</tr>
<tr>
<td colspan="2" style="vertical-align: top; text-align: left; white-space: normal; padding: 4pt 4pt 4pt 4pt;"> *** p &lt; 0.001;  ** p &lt; 0.01;  * p &lt; 0.05.</td>
</tr>
</table>

<p>I cover propensity score matching here because it is widely used. Hence, you need to know how to use it. People would think it’s weird if you didn’t, in the same way that we have to cover ANOVA people would think it’s weird if we had an entire experimental design course and didn’t cover it even though there are more modern ways of looking at differences between two means. But at the same time you need to know that there are flaws with propensity score matching. I will now discuss some of them.</p>
<ol style="list-style-type: decimal">
<li>Matching. Propensity score matching cannot match on unobserved variables. This may be fine in a class-room setting, but in more realistic settings it will likely cause issues.</li>
<li>Modelling. The results tend to be specific to the model that is used. King and Nielsen, 2019, discuss this thoroughly.</li>
<li>Statistically. We are using the data twice.</li>
</ol>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ab-testing-and-rcts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
