<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 18 Case study - Gathering and tidying data from Paspaley | Telling Stories with Data</title>
  <meta name="description" content="Chapter 18 Case study - Gathering and tidying data from Paspaley | Telling Stories with Data" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 18 Case study - Gathering and tidying data from Paspaley | Telling Stories with Data" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 18 Case study - Gathering and tidying data from Paspaley | Telling Stories with Data" />
  
  
  

<meta name="author" content="Rohan Alexander" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="case-study-rohans-books.html"/>
<link rel="next" href="lab-ggplot2.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Telling Stories With Data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#on-telling-stories"><i class="fa fa-check"></i><b>1.1</b> On telling stories</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#telling-stories-with-data"><i class="fa fa-check"></i><b>1.2</b> Telling stories with data</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#these-notes"><i class="fa fa-check"></i><b>1.3</b> These notes</a><ul>
<li class="chapter" data-level="1.3.1" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>1.3.1</b> Software</a></li>
<li class="chapter" data-level="1.3.2" data-path="index.html"><a href="index.html#assumed-background"><i class="fa fa-check"></i><b>1.3.2</b> Assumed background</a></li>
<li class="chapter" data-level="1.3.3" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.3.3</b> Structure</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i><b>1.4</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#contact"><i class="fa fa-check"></i><b>1.5</b> Contact</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lab-getting-started.html"><a href="lab-getting-started.html"><i class="fa fa-check"></i><b>2</b> Lab - Getting started</a><ul>
<li class="chapter" data-level="2.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#tidyverse"><i class="fa fa-check"></i><b>2.2</b> Tidyverse</a><ul>
<li class="chapter" data-level="2.2.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#the-pipe"><i class="fa fa-check"></i><b>2.2.1</b> The pipe</a></li>
<li class="chapter" data-level="2.2.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#select"><i class="fa fa-check"></i><b>2.2.2</b> Select</a></li>
<li class="chapter" data-level="2.2.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#filter"><i class="fa fa-check"></i><b>2.2.3</b> Filter</a></li>
<li class="chapter" data-level="2.2.4" data-path="lab-getting-started.html"><a href="lab-getting-started.html#arrange"><i class="fa fa-check"></i><b>2.2.4</b> Arrange</a></li>
<li class="chapter" data-level="2.2.5" data-path="lab-getting-started.html"><a href="lab-getting-started.html#group_by"><i class="fa fa-check"></i><b>2.2.5</b> group_by</a></li>
<li class="chapter" data-level="2.2.6" data-path="lab-getting-started.html"><a href="lab-getting-started.html#mutate"><i class="fa fa-check"></i><b>2.2.6</b> Mutate</a></li>
<li class="chapter" data-level="2.2.7" data-path="lab-getting-started.html"><a href="lab-getting-started.html#summarise"><i class="fa fa-check"></i><b>2.2.7</b> Summarise</a></li>
<li class="chapter" data-level="2.2.8" data-path="lab-getting-started.html"><a href="lab-getting-started.html#counting-by-group"><i class="fa fa-check"></i><b>2.2.8</b> Counting by group</a></li>
<li class="chapter" data-level="2.2.9" data-path="lab-getting-started.html"><a href="lab-getting-started.html#calculate-proportions"><i class="fa fa-check"></i><b>2.2.9</b> Calculate proportions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#ggplot"><i class="fa fa-check"></i><b>2.3</b> ggplot</a><ul>
<li class="chapter" data-level="2.3.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#main-features"><i class="fa fa-check"></i><b>2.3.1</b> Main features</a></li>
<li class="chapter" data-level="2.3.2" data-path="lab-getting-started.html"><a href="lab-getting-started.html#facets"><i class="fa fa-check"></i><b>2.3.2</b> Facets</a></li>
<li class="chapter" data-level="2.3.3" data-path="lab-getting-started.html"><a href="lab-getting-started.html#small-things"><i class="fa fa-check"></i><b>2.3.3</b> Small things</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="lab-getting-started.html"><a href="lab-getting-started.html#other"><i class="fa fa-check"></i><b>2.4</b> Other</a><ul>
<li class="chapter" data-level="2.4.1" data-path="lab-getting-started.html"><a href="lab-getting-started.html#case_when"><i class="fa fa-check"></i><b>2.4.1</b> case_when</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html"><i class="fa fa-check"></i><b>3</b> Case study - The 2019 Canadian Federal Election</a><ul>
<li class="chapter" data-level="3.1" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#create-a-graph-based-on-the-2019-canadian-federal-election"><i class="fa fa-check"></i><b>3.2</b> Create a graph based on the 2019 Canadian Federal election</a><ul>
<li class="chapter" data-level="3.2.1" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#getting-started"><i class="fa fa-check"></i><b>3.2.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2.2" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#reading-in-the-data"><i class="fa fa-check"></i><b>3.2.2</b> Reading in the data</a></li>
<li class="chapter" data-level="3.2.3" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#clean-the-data"><i class="fa fa-check"></i><b>3.2.3</b> Clean the data</a></li>
<li class="chapter" data-level="3.2.4" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#make-a-graph"><i class="fa fa-check"></i><b>3.2.4</b> Make a graph</a></li>
<li class="chapter" data-level="3.2.5" data-path="case-study-the-2019-canadian-federal-election.html"><a href="case-study-the-2019-canadian-federal-election.html#make-a-table"><i class="fa fa-check"></i><b>3.2.5</b> Make a table</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="communication.html"><a href="communication.html"><i class="fa fa-check"></i><b>4</b> Communication</a><ul>
<li class="chapter" data-level="4.1" data-path="communication.html"><a href="communication.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="communication.html"><a href="communication.html#title-abstract-and-introduction"><i class="fa fa-check"></i><b>4.2</b> Title, abstract, and introduction</a></li>
<li class="chapter" data-level="4.3" data-path="communication.html"><a href="communication.html#figures-tables-equations-and-technical-terms"><i class="fa fa-check"></i><b>4.3</b> Figures, tables, equations, and technical terms</a></li>
<li class="chapter" data-level="4.4" data-path="communication.html"><a href="communication.html#on-brevity"><i class="fa fa-check"></i><b>4.4</b> On brevity</a></li>
<li class="chapter" data-level="4.5" data-path="communication.html"><a href="communication.html#other-1"><i class="fa fa-check"></i><b>4.5</b> Other</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html"><i class="fa fa-check"></i><b>5</b> Lab - Using R in practice</a><ul>
<li class="chapter" data-level="5.1" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#introduction-3"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#getting-help"><i class="fa fa-check"></i><b>5.2</b> Getting help</a></li>
<li class="chapter" data-level="5.3" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#mentality"><i class="fa fa-check"></i><b>5.3</b> Mentality</a></li>
<li class="chapter" data-level="5.4" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#style"><i class="fa fa-check"></i><b>5.4</b> Style</a></li>
<li class="chapter" data-level="5.5" data-path="lab-using-r-in-practice.html"><a href="lab-using-r-in-practice.html#learning-more"><i class="fa fa-check"></i><b>5.5</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ethics.html"><a href="ethics.html"><i class="fa fa-check"></i><b>6</b> Ethics</a><ul>
<li class="chapter" data-level="6.1" data-path="ethics.html"><a href="ethics.html#introduction-4"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="ethics.html"><a href="ethics.html#questiontask"><i class="fa fa-check"></i><b>6.2</b> Question/task</a></li>
<li class="chapter" data-level="6.3" data-path="ethics.html"><a href="ethics.html#data"><i class="fa fa-check"></i><b>6.3</b> Data</a></li>
<li class="chapter" data-level="6.4" data-path="ethics.html"><a href="ethics.html#model"><i class="fa fa-check"></i><b>6.4</b> Model</a></li>
<li class="chapter" data-level="6.5" data-path="ethics.html"><a href="ethics.html#team"><i class="fa fa-check"></i><b>6.5</b> Team</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="case-study-all-state.html"><a href="case-study-all-state.html"><i class="fa fa-check"></i><b>7</b> Case-study: All state</a></li>
<li class="chapter" data-level="8" data-path="case-study-gay-face.html"><a href="case-study-gay-face.html"><i class="fa fa-check"></i><b>8</b> Case-study: Gay face</a></li>
<li class="chapter" data-level="9" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>9</b> Reproducibility</a><ul>
<li class="chapter" data-level="9.1" data-path="reproducibility.html"><a href="reproducibility.html#introduction-5"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="reproducibility.html"><a href="reproducibility.html#data-access"><i class="fa fa-check"></i><b>9.2</b> Data access</a></li>
<li class="chapter" data-level="9.3" data-path="reproducibility.html"><a href="reproducibility.html#on-mistakes"><i class="fa fa-check"></i><b>9.3</b> On mistakes</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html"><i class="fa fa-check"></i><b>10</b> Lab - R Markdown and R Projects</a><ul>
<li class="chapter" data-level="10.1" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-markdown"><i class="fa fa-check"></i><b>10.1</b> R Markdown</a><ul>
<li class="chapter" data-level="10.1.1" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#getting-started-1"><i class="fa fa-check"></i><b>10.1.1</b> Getting started</a></li>
<li class="chapter" data-level="10.1.2" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#basic-commands"><i class="fa fa-check"></i><b>10.1.2</b> Basic commands</a></li>
<li class="chapter" data-level="10.1.3" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-chunks"><i class="fa fa-check"></i><b>10.1.3</b> R chunks</a></li>
<li class="chapter" data-level="10.1.4" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#abstracts-and-pdf-outputs"><i class="fa fa-check"></i><b>10.1.4</b> Abstracts and PDF outputs</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="lab-r-markdown-and-r-projects.html"><a href="lab-r-markdown-and-r-projects.html#r-projects"><i class="fa fa-check"></i><b>10.2</b> R projects</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="lab-git-and-github.html"><a href="lab-git-and-github.html"><i class="fa fa-check"></i><b>11</b> Lab - Git and GitHub</a><ul>
<li class="chapter" data-level="11.1" data-path="lab-git-and-github.html"><a href="lab-git-and-github.html#introduction-6"><i class="fa fa-check"></i><b>11.1</b> Introduction</a></li>
<li class="chapter" data-level="11.2" data-path="lab-git-and-github.html"><a href="lab-git-and-github.html#git"><i class="fa fa-check"></i><b>11.2</b> Git</a></li>
<li class="chapter" data-level="11.3" data-path="lab-git-and-github.html"><a href="lab-git-and-github.html#github"><i class="fa fa-check"></i><b>11.3</b> GitHub</a></li>
<li class="chapter" data-level="11.4" data-path="lab-git-and-github.html"><a href="lab-git-and-github.html#using-git-within-rstudio"><i class="fa fa-check"></i><b>11.4</b> Using Git within RStudio</a></li>
<li class="chapter" data-level="11.5" data-path="lab-git-and-github.html"><a href="lab-git-and-github.html#next-steps"><i class="fa fa-check"></i><b>11.5</b> Next steps</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html"><i class="fa fa-check"></i><b>12</b> Case study - TTC Subway Delays</a><ul>
<li class="chapter" data-level="12.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#introduction-7"><i class="fa fa-check"></i><b>12.1</b> Introduction</a><ul>
<li class="chapter" data-level="12.1.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#prerequesites"><i class="fa fa-check"></i><b>12.1.1</b> Prerequesites</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#finding-and-downloading-data-using-opendatatoronto"><i class="fa fa-check"></i><b>12.2</b> Finding and downloading data using <code>opendatatoronto</code></a><ul>
<li class="chapter" data-level="12.2.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#finding-the-data"><i class="fa fa-check"></i><b>12.2.1</b> Finding the data</a></li>
<li class="chapter" data-level="12.2.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#retrieving-the-data"><i class="fa fa-check"></i><b>12.2.2</b> Retrieving the data</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#plotting"><i class="fa fa-check"></i><b>12.3</b> Plotting</a><ul>
<li class="chapter" data-level="12.3.1" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#example-1-delays-by-line"><i class="fa fa-check"></i><b>12.3.1</b> Example 1: Delays by line</a></li>
<li class="chapter" data-level="12.3.2" data-path="case-study-ttc-subway-delays.html"><a href="case-study-ttc-subway-delays.html#example-2-delays-by-time-of-day"><i class="fa fa-check"></i><b>12.3.2</b> Example 2: Delays by time of day</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="developing-research-questions.html"><a href="developing-research-questions.html"><i class="fa fa-check"></i><b>13</b> Developing research questions</a><ul>
<li class="chapter" data-level="13.1" data-path="developing-research-questions.html"><a href="developing-research-questions.html#developing-research-questions-1"><i class="fa fa-check"></i><b>13.1</b> Developing research questions</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="gathering-data.html"><a href="gathering-data.html"><i class="fa fa-check"></i><b>14</b> Gathering data</a><ul>
<li class="chapter" data-level="14.1" data-path="gathering-data.html"><a href="gathering-data.html#gathering-data-1"><i class="fa fa-check"></i><b>14.1</b> Gathering data</a><ul>
<li class="chapter" data-level="14.1.1" data-path="gathering-data.html"><a href="gathering-data.html#deliberately-available"><i class="fa fa-check"></i><b>14.1.1</b> Deliberately available</a></li>
<li class="chapter" data-level="14.1.2" data-path="gathering-data.html"><a href="gathering-data.html#by-product"><i class="fa fa-check"></i><b>14.1.2</b> By product</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="lab-the-tidyverse.html"><a href="lab-the-tidyverse.html"><i class="fa fa-check"></i><b>15</b> Lab - The Tidyverse</a></li>
<li class="chapter" data-level="16" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html"><i class="fa fa-check"></i><b>16</b> Case study - Canadian Prime Ministers</a><ul>
<li class="chapter" data-level="16.1" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#introduction-8"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#get-data"><i class="fa fa-check"></i><b>16.2</b> Get data</a></li>
<li class="chapter" data-level="16.3" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#parse-html"><i class="fa fa-check"></i><b>16.3</b> Parse html</a><ul>
<li class="chapter" data-level="16.3.1" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#by-inspection"><i class="fa fa-check"></i><b>16.3.1</b> By inspection</a></li>
<li class="chapter" data-level="16.3.2" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#selector-gadget"><i class="fa fa-check"></i><b>16.3.2</b> Selector gadget</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#clean-data"><i class="fa fa-check"></i><b>16.4</b> Clean data</a></li>
<li class="chapter" data-level="16.5" data-path="case-study-canadian-prime-ministers.html"><a href="case-study-canadian-prime-ministers.html#make-graph"><i class="fa fa-check"></i><b>16.5</b> Make graph</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html"><i class="fa fa-check"></i><b>17</b> Case study - Rohan’s books</a><ul>
<li class="chapter" data-level="17.1" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#introduction-9"><i class="fa fa-check"></i><b>17.1</b> Introduction</a></li>
<li class="chapter" data-level="17.2" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#gather-data"><i class="fa fa-check"></i><b>17.2</b> Gather data</a></li>
<li class="chapter" data-level="17.3" data-path="case-study-rohans-books.html"><a href="case-study-rohans-books.html#data-parsing-and-cleaning"><i class="fa fa-check"></i><b>17.3</b> Data parsing and cleaning</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html"><i class="fa fa-check"></i><b>18</b> Case study - Gathering and tidying data from Paspaley</a><ul>
<li class="chapter" data-level="18.1" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#introduction-10"><i class="fa fa-check"></i><b>18.1</b> Introduction</a></li>
<li class="chapter" data-level="18.2" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#data-acquisition"><i class="fa fa-check"></i><b>18.2</b> Data acquisition</a></li>
<li class="chapter" data-level="18.3" data-path="case-study-gathering-and-tidying-data-from-paspaley.html"><a href="case-study-gathering-and-tidying-data-from-paspaley.html#data-cleaning"><i class="fa fa-check"></i><b>18.3</b> Data cleaning</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="lab-ggplot2.html"><a href="lab-ggplot2.html"><i class="fa fa-check"></i><b>19</b> Lab - ggplot2</a></li>
<li class="chapter" data-level="20" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>20</b> Exploratory data analysis</a><ul>
<li class="chapter" data-level="20.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-11"><i class="fa fa-check"></i><b>20.1</b> Introduction</a></li>
<li class="chapter" data-level="20.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#a-note-on-packages"><i class="fa fa-check"></i><b>20.2</b> A note on packages</a></li>
<li class="chapter" data-level="20.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#ttc-subway-delays"><i class="fa fa-check"></i><b>20.3</b> TTC subway delays</a></li>
<li class="chapter" data-level="20.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#eda-and-data-viz"><i class="fa fa-check"></i><b>20.4</b> EDA and data viz</a></li>
<li class="chapter" data-level="20.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#data-checks"><i class="fa fa-check"></i><b>20.5</b> Data checks</a><ul>
<li class="chapter" data-level="20.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#sanity-checks"><i class="fa fa-check"></i><b>20.5.1</b> Sanity Checks</a></li>
<li class="chapter" data-level="20.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values"><i class="fa fa-check"></i><b>20.5.2</b> Missing values</a></li>
<li class="chapter" data-level="20.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#duplicates"><i class="fa fa-check"></i><b>20.5.3</b> Duplicates?</a></li>
<li class="chapter" data-level="20.5.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-distributions"><i class="fa fa-check"></i><b>20.5.4</b> Visualizing distributions</a></li>
<li class="chapter" data-level="20.5.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-time-series"><i class="fa fa-check"></i><b>20.5.5</b> Visualizing time series</a></li>
<li class="chapter" data-level="20.5.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualizing-relationships"><i class="fa fa-check"></i><b>20.5.6</b> Visualizing relationships</a></li>
<li class="chapter" data-level="20.5.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#pca"><i class="fa fa-check"></i><b>20.5.7</b> PCA</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises"><i class="fa fa-check"></i><b>20.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="case-study-historical-canadian-elections.html"><a href="case-study-historical-canadian-elections.html"><i class="fa fa-check"></i><b>21</b> Case study - Historical Canadian elections</a></li>
<li class="chapter" data-level="22" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>22</b> Linear regression</a><ul>
<li class="chapter" data-level="22.1" data-path="linear-regression.html"><a href="linear-regression.html#introduction-12"><i class="fa fa-check"></i><b>22.1</b> Introduction</a></li>
<li class="chapter" data-level="22.2" data-path="linear-regression.html"><a href="linear-regression.html#competing-relationships"><i class="fa fa-check"></i><b>22.2</b> Competing relationships</a></li>
<li class="chapter" data-level="22.3" data-path="linear-regression.html"><a href="linear-regression.html#implementing-this-in-r"><i class="fa fa-check"></i><b>22.3</b> Implementing this in R</a></li>
<li class="chapter" data-level="22.4" data-path="linear-regression.html"><a href="linear-regression.html#tidy-up-with-broom"><i class="fa fa-check"></i><b>22.4</b> Tidy up with broom</a></li>
<li class="chapter" data-level="22.5" data-path="linear-regression.html"><a href="linear-regression.html#testing-hypothesis"><i class="fa fa-check"></i><b>22.5</b> Testing hypothesis</a></li>
<li class="chapter" data-level="22.6" data-path="linear-regression.html"><a href="linear-regression.html#adding-more-and-varied-explanatory-variables"><i class="fa fa-check"></i><b>22.6</b> Adding more and varied explanatory variables</a></li>
<li class="chapter" data-level="22.7" data-path="linear-regression.html"><a href="linear-regression.html#threats-to-validity-and-aspects-to-think-about"><i class="fa fa-check"></i><b>22.7</b> Threats to validity and aspects to think about</a></li>
<li class="chapter" data-level="22.8" data-path="linear-regression.html"><a href="linear-regression.html#more-credible-outputs"><i class="fa fa-check"></i><b>22.8</b> More credible outputs</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="lab-reporting-regression-results.html"><a href="lab-reporting-regression-results.html"><i class="fa fa-check"></i><b>23</b> Lab - Reporting regression results</a></li>
<li class="chapter" data-level="24" data-path="count-data.html"><a href="count-data.html"><i class="fa fa-check"></i><b>24</b> Count data</a><ul>
<li class="chapter" data-level="24.1" data-path="count-data.html"><a href="count-data.html#logistic-regression"><i class="fa fa-check"></i><b>24.1</b> Logistic regression</a></li>
<li class="chapter" data-level="24.2" data-path="count-data.html"><a href="count-data.html#poisson-regression"><i class="fa fa-check"></i><b>24.2</b> Poisson regression</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>25</b> Classification</a></li>
<li class="chapter" data-level="26" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html"><i class="fa fa-check"></i><b>26</b> Case study - Opinions about a casino in Toronto</a><ul>
<li class="chapter" data-level="26.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#data-preparation"><i class="fa fa-check"></i><b>26.1</b> Data preparation</a><ul>
<li class="chapter" data-level="26.1.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-data-from-opendatatoronto"><i class="fa fa-check"></i><b>26.1.1</b> Getting data from <code>opendatatoronto</code></a></li>
<li class="chapter" data-level="26.1.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-the-right-kind-of-object"><i class="fa fa-check"></i><b>26.1.2</b> Getting the right kind of object</a></li>
<li class="chapter" data-level="26.1.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#cleaning-up-the-dataframe"><i class="fa fa-check"></i><b>26.1.3</b> Cleaning up the dataframe</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#some-visual-exploration-and-more-cleanup-of-course"><i class="fa fa-check"></i><b>26.2</b> Some visual exploration (and more cleanup, of course)</a><ul>
<li class="chapter" data-level="26.2.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#getting-the-data-into-a-more-model-suitable-format"><i class="fa fa-check"></i><b>26.2.1</b> Getting the data into a more model-suitable format</a></li>
</ul></li>
<li class="chapter" data-level="26.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#logistic-regression-1"><i class="fa fa-check"></i><b>26.3</b> Logistic Regression</a><ul>
<li class="chapter" data-level="26.3.1" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#interpretation"><i class="fa fa-check"></i><b>26.3.1</b> Interpretation</a></li>
<li class="chapter" data-level="26.3.2" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#baseline-category"><i class="fa fa-check"></i><b>26.3.2</b> Baseline category</a></li>
<li class="chapter" data-level="26.3.3" data-path="case-study-opinions-about-a-casino-in-toronto.html"><a href="case-study-opinions-about-a-casino-in-toronto.html#making-estimates"><i class="fa fa-check"></i><b>26.3.3</b> Making estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="27" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html"><i class="fa fa-check"></i><b>27</b> Case study - Airbnb listing in Toronto</a><ul>
<li class="chapter" data-level="27.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#essentials"><i class="fa fa-check"></i><b>27.1</b> Essentials</a></li>
<li class="chapter" data-level="27.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#set-up"><i class="fa fa-check"></i><b>27.2</b> Set up</a></li>
<li class="chapter" data-level="27.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#get-data-1"><i class="fa fa-check"></i><b>27.3</b> Get data</a></li>
<li class="chapter" data-level="27.4" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#clean-data-1"><i class="fa fa-check"></i><b>27.4</b> Clean data</a><ul>
<li class="chapter" data-level="27.4.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#price"><i class="fa fa-check"></i><b>27.4.1</b> Price</a></li>
<li class="chapter" data-level="27.4.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#superhosts"><i class="fa fa-check"></i><b>27.4.2</b> Superhosts</a></li>
<li class="chapter" data-level="27.4.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#reviews"><i class="fa fa-check"></i><b>27.4.3</b> Reviews</a></li>
<li class="chapter" data-level="27.4.4" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#response-time"><i class="fa fa-check"></i><b>27.4.4</b> Response time</a></li>
<li class="chapter" data-level="27.4.5" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#host-number-of-listings"><i class="fa fa-check"></i><b>27.4.5</b> Host number of listings</a></li>
<li class="chapter" data-level="27.4.6" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#decisions"><i class="fa fa-check"></i><b>27.4.6</b> Decisions</a></li>
</ul></li>
<li class="chapter" data-level="27.5" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#explore-data"><i class="fa fa-check"></i><b>27.5</b> Explore data</a><ul>
<li class="chapter" data-level="27.5.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#price-and-reviews"><i class="fa fa-check"></i><b>27.5.1</b> Price and reviews</a></li>
<li class="chapter" data-level="27.5.2" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#superhost-and-response-time"><i class="fa fa-check"></i><b>27.5.2</b> Superhost and response-time</a></li>
<li class="chapter" data-level="27.5.3" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#neighbourhood"><i class="fa fa-check"></i><b>27.5.3</b> Neighbourhood</a></li>
</ul></li>
<li class="chapter" data-level="27.6" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#model-data"><i class="fa fa-check"></i><b>27.6</b> Model data</a><ul>
<li class="chapter" data-level="27.6.1" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#logistic-regression-2"><i class="fa fa-check"></i><b>27.6.1</b> Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="27.7" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#next-steps-1"><i class="fa fa-check"></i><b>27.7</b> Next steps</a></li>
<li class="chapter" data-level="27.8" data-path="case-study-airbnb-listing-in-toronto.html"><a href="case-study-airbnb-listing-in-toronto.html#references"><i class="fa fa-check"></i><b>27.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html"><i class="fa fa-check"></i><b>28</b> A/B testing and RCTs</a><ul>
<li class="chapter" data-level="28.1" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#introduction-13"><i class="fa fa-check"></i><b>28.1</b> Introduction</a></li>
<li class="chapter" data-level="28.2" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#motivation"><i class="fa fa-check"></i><b>28.2</b> Motivation</a></li>
<li class="chapter" data-level="28.3" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#tea-party"><i class="fa fa-check"></i><b>28.3</b> Tea party</a></li>
<li class="chapter" data-level="28.4" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#some-unexpected-properties-from-randomised-sampling"><i class="fa fa-check"></i><b>28.4</b> Some unexpected properties from randomised sampling</a></li>
<li class="chapter" data-level="28.5" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#anova"><i class="fa fa-check"></i><b>28.5</b> ANOVA</a></li>
<li class="chapter" data-level="28.6" data-path="ab-testing-and-rcts.html"><a href="ab-testing-and-rcts.html#treatment-and-control"><i class="fa fa-check"></i><b>28.6</b> Treatment and control</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="lab-mobile-games.html"><a href="lab-mobile-games.html"><i class="fa fa-check"></i><b>29</b> Lab: Mobile games</a><ul>
<li class="chapter" data-level="29.1" data-path="lab-mobile-games.html"><a href="lab-mobile-games.html#introduction-14"><i class="fa fa-check"></i><b>29.1</b> Introduction</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html"><i class="fa fa-check"></i><b>30</b> Matching &amp; difference-in-differences</a><ul>
<li class="chapter" data-level="30.1" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#introduction-15"><i class="fa fa-check"></i><b>30.1</b> Introduction</a></li>
<li class="chapter" data-level="30.2" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#motivation-1"><i class="fa fa-check"></i><b>30.2</b> Motivation</a></li>
<li class="chapter" data-level="30.3" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#simulated-example"><i class="fa fa-check"></i><b>30.3</b> Simulated example</a></li>
<li class="chapter" data-level="30.4" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#assumptions"><i class="fa fa-check"></i><b>30.4</b> Assumptions</a></li>
<li class="chapter" data-level="30.5" data-path="matching-difference-in-differences.html"><a href="matching-difference-in-differences.html#matching"><i class="fa fa-check"></i><b>30.5</b> Matching</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><i class="fa fa-check"></i><b>31</b> Case study - Lower advertising revenue reduced French newspaper prices between 1960 and 1974</a><ul>
<li class="chapter" data-level="31.1" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#introduction-16"><i class="fa fa-check"></i><b>31.1</b> Introduction</a></li>
<li class="chapter" data-level="31.2" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#background"><i class="fa fa-check"></i><b>31.2</b> Background</a></li>
<li class="chapter" data-level="31.3" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#data-1"><i class="fa fa-check"></i><b>31.3</b> Data</a></li>
<li class="chapter" data-level="31.4" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#model-1"><i class="fa fa-check"></i><b>31.4</b> Model</a></li>
<li class="chapter" data-level="31.5" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#results"><i class="fa fa-check"></i><b>31.5</b> Results</a></li>
<li class="chapter" data-level="31.6" data-path="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html"><a href="case-study-lower-advertising-revenue-reduced-french-newspaper-prices-between-1960-and-1974.html#other-points"><i class="fa fa-check"></i><b>31.6</b> Other points</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="tutorial-propensity-score-matching-lalonde.html"><a href="tutorial-propensity-score-matching-lalonde.html"><i class="fa fa-check"></i><b>32</b> Tutorial - Propensity score matching - Lalonde</a></li>
<li class="chapter" data-level="33" data-path="shiny-applications.html"><a href="shiny-applications.html"><i class="fa fa-check"></i><b>33</b> Shiny applications</a></li>
<li class="chapter" data-level="34" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html"><i class="fa fa-check"></i><b>34</b> Regression discontinuity design</a><ul>
<li class="chapter" data-level="34.1" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#introduction-17"><i class="fa fa-check"></i><b>34.1</b> Introduction</a></li>
<li class="chapter" data-level="34.2" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#simulated-example-1"><i class="fa fa-check"></i><b>34.2</b> Simulated example</a><ul>
<li class="chapter" data-level="34.2.1" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#different-slopes"><i class="fa fa-check"></i><b>34.2.1</b> Different slopes</a></li>
</ul></li>
<li class="chapter" data-level="34.3" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#overlap"><i class="fa fa-check"></i><b>34.3</b> Overlap</a></li>
<li class="chapter" data-level="34.4" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#examples"><i class="fa fa-check"></i><b>34.4</b> Examples</a><ul>
<li class="chapter" data-level="34.4.1" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#elections"><i class="fa fa-check"></i><b>34.4.1</b> Elections</a></li>
<li class="chapter" data-level="34.4.2" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#economic-development"><i class="fa fa-check"></i><b>34.4.2</b> Economic development</a></li>
</ul></li>
<li class="chapter" data-level="34.5" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#implementation"><i class="fa fa-check"></i><b>34.5</b> Implementation</a></li>
<li class="chapter" data-level="34.6" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#fuzzy-rdd"><i class="fa fa-check"></i><b>34.6</b> Fuzzy RDD</a></li>
<li class="chapter" data-level="34.7" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#threats-to-validity"><i class="fa fa-check"></i><b>34.7</b> Threats to validity</a></li>
<li class="chapter" data-level="34.8" data-path="regression-discontinuity-design.html"><a href="regression-discontinuity-design.html#weaknesses"><i class="fa fa-check"></i><b>34.8</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="instrumental-variables.html"><a href="instrumental-variables.html"><i class="fa fa-check"></i><b>35</b> Instrumental variables</a></li>
<li class="chapter" data-level="36" data-path="assessment.html"><a href="assessment.html"><i class="fa fa-check"></i><b>36</b> Assessment</a><ul>
<li class="chapter" data-level="36.1" data-path="assessment.html"><a href="assessment.html#problem-set-1"><i class="fa fa-check"></i><b>36.1</b> Problem Set 1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references-1.html"><a href="references-1.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Telling Stories with Data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="case-study---gathering-and-tidying-data-from-paspaley" class="section level1">
<h1><span class="header-section-number">Chapter 18</span> Case study - Gathering and tidying data from Paspaley</h1>
<p><strong>TODO: Need to come and explain all of this. Also, change it all to 2019.</strong></p>
<p><strong>Key concepts/skills/etc</strong></p>
<ul>
<li>Gathering data from websites</li>
<li>Cleaning data</li>
</ul>
<p><strong>Key libraries</strong></p>
<ul>
<li><code>tidyverse</code></li>
<li><code>ggplot2</code></li>
<li><code>purrr</code></li>
<li><code>rvest</code></li>
</ul>
<p><strong>Key functions/etc</strong></p>
<ul>
<li>TBD</li>
</ul>
<div id="introduction-10" class="section level2">
<h2><span class="header-section-number">18.1</span> Introduction</h2>
<p>Paspaly make the best pearl jewelry in the world. Unfortunately it’s priced accordingly so actual Paspaley purchases may be more rare than you may like. It might be interesting to respectfully scrape their website and see if we can have a look at their offerings.</p>
</div>
<div id="data-acquisition" class="section level2">
<h2><span class="header-section-number">18.2</span> Data acquisition</h2>
<p>Looking at the website: <a href="https://www.paspaley.com/" class="uri">https://www.paspaley.com/</a>, Paspaley organises the products by category (e.g. bracelet, earrings, etc).</p>
<div class="figure"><span id="fig:unnamed-chunk-87"></span>
<img src="figures/category.png" alt="Screnshot of the categories page." width="1138" />
<p class="caption">
Figure 18.1: Screnshot of the categories page.
</p>
</div>
<p>It also categorises them by collection (e.g. Monsoon, Rockpool, etc).</p>
<div class="figure"><span id="fig:unnamed-chunk-88"></span>
<img src="figures/collection.png" alt="Screnshot of the collections page." width="1146" />
<p class="caption">
Figure 18.2: Screnshot of the collections page.
</p>
</div>
<p>Save each of those summary pages and we can then scrape the links for each of the individual products from them using rvest.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb156-4" data-line-number="4"></a>
<a class="sourceLine" id="cb156-5" data-line-number="5"><span class="co"># We&#39;re doing it properly and writing a function. We&#39;ll pass that function, and a list of files on which to apply it, to purrr.</span></a>
<a class="sourceLine" id="cb156-6" data-line-number="6">get_links &lt;-<span class="st"> </span><span class="cf">function</span>(file_to_look_at){</a>
<a class="sourceLine" id="cb156-7" data-line-number="7">  content &lt;-<span class="st"> </span><span class="kw">read_html</span>(file_to_look_at) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-8" data-line-number="8"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.product-item-info&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-9" data-line-number="9"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.product&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-10" data-line-number="10"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>)</a>
<a class="sourceLine" id="cb156-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb156-12" data-line-number="12">  link &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-13" data-line-number="13"><span class="st">    </span><span class="kw">html_attr</span>(<span class="st">&quot;href&quot;</span>)</a>
<a class="sourceLine" id="cb156-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb156-15" data-line-number="15">  text &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-16" data-line-number="16"><span class="st">    </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb156-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb156-18" data-line-number="18">  collection &lt;-<span class="st"> </span><span class="kw">str_replace</span>(file_to_look_at, <span class="st">&quot;inputs/paspaley/lists_by_collection/&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-19" data-line-number="19"><span class="st">    </span><span class="kw">str_replace</span>(<span class="st">&quot;.htm&quot;</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb156-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb156-21" data-line-number="21">  <span class="kw">return</span>(<span class="kw">tibble</span>(<span class="dt">link =</span> link, <span class="dt">text =</span> text, <span class="dt">collection =</span> collection))</a>
<a class="sourceLine" id="cb156-22" data-line-number="22">}</a>
<a class="sourceLine" id="cb156-23" data-line-number="23"></a>
<a class="sourceLine" id="cb156-24" data-line-number="24"></a>
<a class="sourceLine" id="cb156-25" data-line-number="25">the_files &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb156-26" data-line-number="26">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/kimberley.htm&quot;</span>,</a>
<a class="sourceLine" id="cb156-27" data-line-number="27">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/lavalier.htm&quot;</span>,</a>
<a class="sourceLine" id="cb156-28" data-line-number="28">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/maxima.htm&quot;</span>,</a>
<a class="sourceLine" id="cb156-29" data-line-number="29">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/monsoon.htm&quot;</span>,</a>
<a class="sourceLine" id="cb156-30" data-line-number="30">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/rockpool.htm&quot;</span>,</a>
<a class="sourceLine" id="cb156-31" data-line-number="31">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/strand.htm&quot;</span>,</a>
<a class="sourceLine" id="cb156-32" data-line-number="32">  <span class="st">&quot;inputs/paspaley/lists/lists_by_collection/touchstone.htm&quot;</span></a>
<a class="sourceLine" id="cb156-33" data-line-number="33">)</a>
<a class="sourceLine" id="cb156-34" data-line-number="34"></a>
<a class="sourceLine" id="cb156-35" data-line-number="35"></a>
<a class="sourceLine" id="cb156-36" data-line-number="36">the_data &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_df</span>(the_files, get_links)</a>
<a class="sourceLine" id="cb156-37" data-line-number="37"></a>
<a class="sourceLine" id="cb156-38" data-line-number="38"></a>
<a class="sourceLine" id="cb156-39" data-line-number="39">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb156-40" data-line-number="40"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">product =</span> <span class="kw">str_replace_all</span>(link, <span class="kw">c</span>(<span class="st">&quot;https://www.paspaley.com/pearl-collections/the-kimberley-bracelet/&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-41" data-line-number="41">                                           <span class="st">&quot;https://www.paspaley.com/pearl-collections/lavalier/&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-42" data-line-number="42">                                           <span class="st">&quot;https://www.paspaley.com/pearl-collections/maxima/&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-43" data-line-number="43">                                           <span class="st">&quot;https://www.paspaley.com/pearl-collections/monsoon/&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-44" data-line-number="44">                                           <span class="st">&quot;https://www.paspaley.com/pearl-collections/rockpool/&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-45" data-line-number="45">                                           <span class="st">&quot;https://www.paspaley.com/pearl-collections/strands/&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb156-46" data-line-number="46">                                           <span class="st">&quot;https://www.paspaley.com/pearl-collections/touchstone/&quot;</span> =<span class="st"> &quot;&quot;</span>)),</a>
<a class="sourceLine" id="cb156-47" data-line-number="47">         <span class="dt">year =</span> <span class="dv">2019</span>)</a>
<a class="sourceLine" id="cb156-48" data-line-number="48"></a>
<a class="sourceLine" id="cb156-49" data-line-number="49"><span class="kw">write_csv</span>(the_data, <span class="st">&quot;outputs/misc/2019_links_from_collections.csv&quot;</span>)</a></code></pre></div>
<p>You can use a similar script to get the categories. Comparing the two indicates that the XML had a handful of products that were not part of a collection or a category, but not vice versa, so no worries.</p>
<p>Now that we have the list of the products that we’d like details about, we need to download the page for each product.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb157-3" data-line-number="3"></a>
<a class="sourceLine" id="cb157-4" data-line-number="4">the_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/2019_links_from_categories.csv&quot;</span>)</a>
<a class="sourceLine" id="cb157-5" data-line-number="5"></a>
<a class="sourceLine" id="cb157-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(the_data<span class="op">$</span>link)) {</a>
<a class="sourceLine" id="cb157-7" data-line-number="7">  product_data &lt;-<span class="st"> </span><span class="kw">read_html</span>(the_data<span class="op">$</span>link[i]) </a>
<a class="sourceLine" id="cb157-8" data-line-number="8">  product_name &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>link[i], <span class="st">&quot;https://www.paspaley.com/jewellery/&quot;</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb157-9" data-line-number="9">  product_name &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(product_name, <span class="st">&quot;/&quot;</span>, <span class="st">&quot;-&quot;</span>)</a>
<a class="sourceLine" id="cb157-10" data-line-number="10">  name_of_file &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;inputs/2019/products/&quot;</span>, product_name, <span class="st">&quot;.html&quot;</span>) </a>
<a class="sourceLine" id="cb157-11" data-line-number="11">  <span class="kw">write_html</span>(product_data, <span class="dt">file =</span> name_of_file)</a>
<a class="sourceLine" id="cb157-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb157-13" data-line-number="13">  <span class="kw">print</span>(<span class="kw">paste</span>(</a>
<a class="sourceLine" id="cb157-14" data-line-number="14">    <span class="st">&quot;Done with file number&quot;</span>,</a>
<a class="sourceLine" id="cb157-15" data-line-number="15">    i,</a>
<a class="sourceLine" id="cb157-16" data-line-number="16">    <span class="st">&quot;of&quot;</span>,</a>
<a class="sourceLine" id="cb157-17" data-line-number="17">    <span class="kw">length</span>(the_data<span class="op">$</span>link),</a>
<a class="sourceLine" id="cb157-18" data-line-number="18">    <span class="st">&quot;at&quot;</span>,</a>
<a class="sourceLine" id="cb157-19" data-line-number="19">    <span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb157-20" data-line-number="20">  ))  <span class="co"># Helpful updating for when running it on all the records</span></a>
<a class="sourceLine" id="cb157-21" data-line-number="21">  <span class="kw">Sys.sleep</span>(<span class="dv">60</span>) <span class="co"># Space requests by 60 seconds.</span></a>
<a class="sourceLine" id="cb157-22" data-line-number="22">}</a>
<a class="sourceLine" id="cb157-23" data-line-number="23"></a>
<a class="sourceLine" id="cb157-24" data-line-number="24"></a>
<a class="sourceLine" id="cb157-25" data-line-number="25"><span class="co"># Clean up</span></a>
<a class="sourceLine" id="cb157-26" data-line-number="26"><span class="kw">rm</span>(i, name_of_file, product_data, product_name)</a></code></pre></div>
<p>I’ve spaced out the requests by 60 seconds here. Again this is just about trying to not affect the performance of their site for other visitors. I’m not in a hurry for this project, so I just slow down the requests a fair bit. In this case there were only a few hundred pages, so it was just a matter of setting the computer to run while I was busy with lunch. Not a big deal. Also, I haven’t accounted for page errors, which would pause the script, like I would with a full-scale project. The way to do that is to change the scraper to a function and then to use safely on it.</p>
<p>Now that we have saved the pages for each product and we don’t need to bother their website anymore we can get to organising the content into a dataset.</p>
</div>
<div id="data-cleaning" class="section level2">
<h2><span class="header-section-number">18.3</span> Data cleaning</h2>
<p>In the last section we downloaded the pages for each of the Paspaley products that we could find on the website. The first step to being able to analyse the data is to transform it in a format that we’re more used to, such as a table.</p>
<p>So the task is to go through the html for each product and find the information that we are interested in: Name; Price; SKU; and Description. We’re going to be using the description to get some additional information that isn’t nicely laid out, such as the type of gold. The SKU is a unique identifier that will let us link products between years.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">library</span>(purrr) <span class="co"># Makes it easier to do the same thing to many files</span></a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="kw">library</span>(rvest) <span class="co"># Goes trhough the html tags and finds what we are looking for</span></a>
<a class="sourceLine" id="cb158-3" data-line-number="3"><span class="kw">library</span>(tidyverse) </a>
<a class="sourceLine" id="cb158-4" data-line-number="4"></a>
<a class="sourceLine" id="cb158-5" data-line-number="5">get_product_data &lt;-<span class="st"> </span><span class="cf">function</span>(file_to_look_at){</a>
<a class="sourceLine" id="cb158-6" data-line-number="6">  <span class="co"># file_to_look_at &lt;- c(&quot;inputs/2018/products/pearl-earrings-diamond-touchstone-earrings-12mm-oval-yellow-gold.html&quot;)</span></a>
<a class="sourceLine" id="cb158-7" data-line-number="7">  <span class="co"># When I&#39;m writing and testing a function I tend to insert one of the files manually here. I&#39;m sure there&#39;s better ways to do this but this seems to work. (I normally delete it before showing anyone!)</span></a>
<a class="sourceLine" id="cb158-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb158-9" data-line-number="9">  content &lt;-<span class="st"> </span><span class="kw">read_html</span>(file_to_look_at) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># read_html is an equivalent to, say, read_csv but for html files.</span></a>
<a class="sourceLine" id="cb158-10" data-line-number="10"><span class="st">    </span><span class="kw">html_nodes</span>(<span class="st">&quot;.product-info-main&quot;</span>) <span class="co"># Here we specify which set of nodes we are interested in. These are the ones that have to do with the products. You need to have a look at the html to work this out and it tends to be a bit of trial an error. </span></a>
<a class="sourceLine" id="cb158-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb158-12" data-line-number="12">    name &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-13" data-line-number="13"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.base&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Focus on the node that has the name</span></a>
<a class="sourceLine" id="cb158-14" data-line-number="14"><span class="st">      </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="co"># This gets the text from that node - depending on what type of information you&#39;re interested in, it might not be needed.</span></a>
<a class="sourceLine" id="cb158-15" data-line-number="15">    </a>
<a class="sourceLine" id="cb158-16" data-line-number="16">    description &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-17" data-line-number="17"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.short-description&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb158-18" data-line-number="18"><span class="st">      </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb158-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb158-20" data-line-number="20">    description &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is_empty</span>(description), <span class="st">&quot;none&quot;</span>, description) <span class="co"># Just in case they don&#39;t have a description we don&#39;t want an error.</span></a>
<a class="sourceLine" id="cb158-21" data-line-number="21">    </a>
<a class="sourceLine" id="cb158-22" data-line-number="22">    flowerydescription &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-23" data-line-number="23"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.description&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb158-24" data-line-number="24"><span class="st">      </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>) <span class="co"># Some of the products have extra descriptions.</span></a>
<a class="sourceLine" id="cb158-25" data-line-number="25">    </a>
<a class="sourceLine" id="cb158-26" data-line-number="26">    flowerydescription &lt;-<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is_empty</span>(flowerydescription), <span class="st">&quot;none&quot;</span>, flowerydescription)</a>
<a class="sourceLine" id="cb158-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb158-28" data-line-number="28">    availability &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-29" data-line-number="29"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.stock&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb158-30" data-line-number="30"><span class="st">      </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb158-31" data-line-number="31">    </a>
<a class="sourceLine" id="cb158-32" data-line-number="32">    sku &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-33" data-line-number="33"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.sku&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb158-34" data-line-number="34"><span class="st">      </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb158-35" data-line-number="35">    </a>
<a class="sourceLine" id="cb158-36" data-line-number="36">    price &lt;-<span class="st"> </span>content <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-37" data-line-number="37"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;.price&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb158-38" data-line-number="38"><span class="st">      </span><span class="kw">html_text</span>(<span class="dt">trim =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb158-39" data-line-number="39">    </a>
<a class="sourceLine" id="cb158-40" data-line-number="40">  <span class="kw">return</span>(<span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb158-41" data-line-number="41">    <span class="dt">name =</span> name,</a>
<a class="sourceLine" id="cb158-42" data-line-number="42">    <span class="dt">description =</span> description,</a>
<a class="sourceLine" id="cb158-43" data-line-number="43">    <span class="dt">flowerydescription =</span> flowerydescription,</a>
<a class="sourceLine" id="cb158-44" data-line-number="44">    <span class="dt">availability =</span> availability,</a>
<a class="sourceLine" id="cb158-45" data-line-number="45">    <span class="dt">sku =</span> sku,</a>
<a class="sourceLine" id="cb158-46" data-line-number="46">    <span class="dt">price =</span> price</a>
<a class="sourceLine" id="cb158-47" data-line-number="47">    )) <span class="co"># Here we gather everything into a table. Purrr will automatically combine the tables for each of the products.</span></a>
<a class="sourceLine" id="cb158-48" data-line-number="48">}</a>
<a class="sourceLine" id="cb158-49" data-line-number="49"></a>
<a class="sourceLine" id="cb158-50" data-line-number="50"></a>
<a class="sourceLine" id="cb158-51" data-line-number="51">products &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;inputs/2019/products&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>) <span class="co"># Return a list of the the files. Handy when there are many files, otherwise just a manual list works too. You can also specify the file type or that they start/end with certain words etc. Very handy.</span></a>
<a class="sourceLine" id="cb158-52" data-line-number="52"></a>
<a class="sourceLine" id="cb158-53" data-line-number="53"><span class="kw">names</span>(products) &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;inputs/2019/products&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb158-54" data-line-number="54"><span class="st">  </span><span class="kw">gsub</span>(<span class="dt">pattern =</span> <span class="st">&quot;.html$&quot;</span>, <span class="dt">replacement =</span> <span class="st">&quot;&quot;</span>) <span class="co"># This just allows us to include the names of the files in the eventual full table. You can make this better so that it doesn&#39;t list the files again (dangerous in case the order changes between listings), but for this project it&#39;s fine.</span></a>
<a class="sourceLine" id="cb158-55" data-line-number="55"></a>
<a class="sourceLine" id="cb158-56" data-line-number="56">dataset &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_df</span>(products, <span class="co"># List of files</span></a>
<a class="sourceLine" id="cb158-57" data-line-number="57">                         get_product_data, <span class="co"># Function to apply to each file</span></a>
<a class="sourceLine" id="cb158-58" data-line-number="58">                         <span class="dt">.id =</span> <span class="st">&quot;product&quot;</span> <span class="co"># Name of the column with the filenames (otherwise the content is just 1, 2, 3,...)</span></a>
<a class="sourceLine" id="cb158-59" data-line-number="59">                         ) <span class="co"># </span></a>
<a class="sourceLine" id="cb158-60" data-line-number="60"></a>
<a class="sourceLine" id="cb158-61" data-line-number="61"><span class="kw">write_csv</span>(dataset, <span class="st">&quot;outputs/2019_dataset.csv&quot;</span>)</a></code></pre></div>
<p>We now have the data into a table that we can work with. Unlike the usual teaching datasets, we need to clean the data so that we can apply our usual methods to them. For instance, many of the prices aren’t an integer because they have AUD in front of them and some of the SKUs have SKU in front, but not all. (I’ve not really gone into detail about the 2017 data, and it sort of just apepars here now, but it was a similar process of getting it to here.)</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="kw">library</span>(stringr) <span class="co"># Used to make regular expressions less confronting</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb159-3" data-line-number="3"></a>
<a class="sourceLine" id="cb159-4" data-line-number="4"></a>
<a class="sourceLine" id="cb159-5" data-line-number="5"><span class="co"># Read in the datasets</span></a>
<a class="sourceLine" id="cb159-6" data-line-number="6">the_<span class="dv">2018</span>_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/data/2018_dataset.csv&quot;</span>)</a>
<a class="sourceLine" id="cb159-7" data-line-number="7">the_<span class="dv">2017</span>_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/data/2017_dataset.csv&quot;</span>)</a>
<a class="sourceLine" id="cb159-8" data-line-number="8"></a>
<a class="sourceLine" id="cb159-9" data-line-number="9"></a>
<a class="sourceLine" id="cb159-10" data-line-number="10"><span class="co"># Combine the datasets</span></a>
<a class="sourceLine" id="cb159-11" data-line-number="11">the_<span class="dv">2018</span>_data<span class="op">$</span>year =<span class="st"> </span><span class="dv">2018</span></a>
<a class="sourceLine" id="cb159-12" data-line-number="12">the_<span class="dv">2017</span>_data<span class="op">$</span>year =<span class="st"> </span><span class="dv">2017</span></a>
<a class="sourceLine" id="cb159-13" data-line-number="13">the_data &lt;-<span class="st"> </span><span class="kw">rbind</span>(the_<span class="dv">2017</span>_data, the_<span class="dv">2018</span>_data)</a>
<a class="sourceLine" id="cb159-14" data-line-number="14"><span class="kw">rm</span>(the_<span class="dv">2017</span>_data, the_<span class="dv">2018</span>_data)</a>
<a class="sourceLine" id="cb159-15" data-line-number="15"></a>
<a class="sourceLine" id="cb159-16" data-line-number="16"></a>
<a class="sourceLine" id="cb159-17" data-line-number="17"><span class="co"># Fix price</span></a>
<a class="sourceLine" id="cb159-18" data-line-number="18">the_data<span class="op">$</span>price &lt;-<span class="st"> </span>?<span class="kw">str_replace_all</span>(the_data<span class="op">$</span>price, <span class="st">&quot;[</span><span class="ch">\r\n</span><span class="st">]&quot;</span> , <span class="st">&quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb159-19" data-line-number="19"><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;.*</span><span class="ch">\\</span><span class="st">$&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="co"># Get rid of the &quot;Starting from...&quot; ones - we just want a number - this is an issue with some of the 2017 ones</span></a>
<a class="sourceLine" id="cb159-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb159-21" data-line-number="21">the_data<span class="op">$</span>price &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>price, <span class="kw">c</span>(<span class="st">&quot;AUD &quot;</span> =<span class="st">  &quot;&quot;</span>, <span class="st">&quot;,&quot;</span> =<span class="st"> &quot;&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb159-22" data-line-number="22"><span class="st">  </span><span class="kw">as.integer</span>() <span class="co"># Convert to a integer - the 2018 ones start with AUD so remove that first</span></a>
<a class="sourceLine" id="cb159-23" data-line-number="23"></a>
<a class="sourceLine" id="cb159-24" data-line-number="24"></a>
<a class="sourceLine" id="cb159-25" data-line-number="25"><span class="co"># Fix SKU</span></a>
<a class="sourceLine" id="cb159-26" data-line-number="26">the_data<span class="op">$</span>sku &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>sku, <span class="kw">c</span>(<span class="st">&quot;SKU    &quot;</span> =<span class="st">  &quot;&quot;</span>)) <span class="co"># The 2018 ones actually start with &quot;SKU&quot; but we just want the number</span></a></code></pre></div>
<p>We’d like to be able to group the analysis by the type of item it is (necklace, earrings, etc) and by the collection (Rockpool). We can use our earlier checks to be able to get the category that Paspaley has put each item into. And we can look at the names and descriptions fields for the ones that were missing.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># Identify the collection</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="co"># First start by using the collections in the website</span></a>
<a class="sourceLine" id="cb160-3" data-line-number="3">links_by_collection_<span class="dv">2018</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/misc/2018_links_from_collections.csv&quot;</span>)</a>
<a class="sourceLine" id="cb160-4" data-line-number="4">links_by_collection_<span class="dv">2017</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/misc/2017_links_from_collections.csv&quot;</span>)</a>
<a class="sourceLine" id="cb160-5" data-line-number="5">links_by_collection &lt;-<span class="st"> </span><span class="kw">rbind</span>(links_by_collection_<span class="dv">2017</span>, links_by_collection_<span class="dv">2018</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(collection, product, year)</a>
<a class="sourceLine" id="cb160-7" data-line-number="7"><span class="kw">rm</span>(links_by_collection_<span class="dv">2017</span>, links_by_collection_<span class="dv">2018</span>)</a>
<a class="sourceLine" id="cb160-8" data-line-number="8"></a>
<a class="sourceLine" id="cb160-9" data-line-number="9">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">for_matching =</span> <span class="kw">str_replace_all</span>(product, <span class="kw">c</span>(<span class="st">&quot;pearl-accessories-&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb160-11" data-line-number="11">                                                   <span class="st">&quot;pearl-bracelets-&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb160-12" data-line-number="12">                                                   <span class="st">&quot;pearl-clasps-&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb160-13" data-line-number="13">                                                   <span class="st">&quot;pearl-earrings-&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb160-14" data-line-number="14">                                                   <span class="st">&quot;pearl-necklaces-&quot;</span> =<span class="st"> &quot;&quot;</span>,</a>
<a class="sourceLine" id="cb160-15" data-line-number="15">                                                   <span class="st">&quot;pearl-rings-&quot;</span> =<span class="st"> &quot;&quot;</span>)))</a>
<a class="sourceLine" id="cb160-16" data-line-number="16"></a>
<a class="sourceLine" id="cb160-17" data-line-number="17">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-18" data-line-number="18"><span class="st">  </span><span class="kw">left_join</span>(links_by_collection, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span> =<span class="st"> &quot;year&quot;</span>,</a>
<a class="sourceLine" id="cb160-19" data-line-number="19">                                        <span class="st">&quot;for_matching&quot;</span> =<span class="st"> &quot;product&quot;</span>))</a>
<a class="sourceLine" id="cb160-20" data-line-number="20"></a>
<a class="sourceLine" id="cb160-21" data-line-number="21"><span class="kw">rm</span>(links_by_collection)</a>
<a class="sourceLine" id="cb160-22" data-line-number="22"></a>
<a class="sourceLine" id="cb160-23" data-line-number="23"><span class="co"># Now, by looking at the content if it wasn&#39;t identified already</span></a>
<a class="sourceLine" id="cb160-24" data-line-number="24">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-25" data-line-number="25"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">collection_brute_force =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb160-26" data-line-number="26">    <span class="kw">str_detect</span>(product, <span class="st">&quot;kimberley&quot;</span>) <span class="op">~</span><span class="st"> &quot;kimberley&quot;</span>,</a>
<a class="sourceLine" id="cb160-27" data-line-number="27">    <span class="kw">str_detect</span>(product, <span class="st">&quot;lavalier&quot;</span>) <span class="op">~</span><span class="st"> &quot;lavalier&quot;</span>,</a>
<a class="sourceLine" id="cb160-28" data-line-number="28">    <span class="kw">str_detect</span>(product, <span class="st">&quot;maxima&quot;</span>) <span class="op">~</span><span class="st"> &quot;maxima&quot;</span>,</a>
<a class="sourceLine" id="cb160-29" data-line-number="29">    <span class="kw">str_detect</span>(product, <span class="st">&quot;monsoon&quot;</span>) <span class="op">~</span><span class="st"> &quot;monsoon&quot;</span>,</a>
<a class="sourceLine" id="cb160-30" data-line-number="30">    <span class="kw">str_detect</span>(product, <span class="st">&quot;pearls-my-way&quot;</span>) <span class="op">~</span><span class="st"> &quot;pearls_my_way&quot;</span>,</a>
<a class="sourceLine" id="cb160-31" data-line-number="31">    <span class="kw">str_detect</span>(product, <span class="st">&quot;rockpool&quot;</span>) <span class="op">~</span><span class="st"> &quot;rockpool&quot;</span>,</a>
<a class="sourceLine" id="cb160-32" data-line-number="32">    <span class="kw">str_detect</span>(product, <span class="st">&quot;strand&quot;</span>) <span class="op">~</span><span class="st"> &quot;strand&quot;</span>,</a>
<a class="sourceLine" id="cb160-33" data-line-number="33">    <span class="kw">str_detect</span>(product, <span class="st">&quot;gold-keshi-rhapsody&quot;</span>) <span class="op">~</span><span class="st"> &quot;strand&quot;</span>, <span class="co"># outlier</span></a>
<a class="sourceLine" id="cb160-34" data-line-number="34">    <span class="kw">str_detect</span>(product, <span class="st">&quot;touchstone&quot;</span>) <span class="op">~</span><span class="st"> &quot;touchstone&quot;</span>,</a>
<a class="sourceLine" id="cb160-35" data-line-number="35">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;other&quot;</span></a>
<a class="sourceLine" id="cb160-36" data-line-number="36">    ))</a>
<a class="sourceLine" id="cb160-37" data-line-number="37"></a>
<a class="sourceLine" id="cb160-38" data-line-number="38"></a>
<a class="sourceLine" id="cb160-39" data-line-number="39">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-40" data-line-number="40"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">collection =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(collection), collection_brute_force, collection)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-41" data-line-number="41"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>collection_brute_force) </a>
<a class="sourceLine" id="cb160-42" data-line-number="42"></a>
<a class="sourceLine" id="cb160-43" data-line-number="43">the_data<span class="op">$</span>collection[the_data<span class="op">$</span>collection <span class="op">==</span><span class="st"> &quot;pearls_my_way&quot;</span>] &lt;-<span class="st"> &quot;Pearls My Way&quot;</span></a>
<a class="sourceLine" id="cb160-44" data-line-number="44">the_data<span class="op">$</span>collection &lt;-<span class="st"> </span><span class="kw">str_to_title</span>(the_data<span class="op">$</span>collection , <span class="dt">locale =</span> <span class="st">&quot;en&quot;</span>)</a>
<a class="sourceLine" id="cb160-45" data-line-number="45"></a>
<a class="sourceLine" id="cb160-46" data-line-number="46"></a>
<a class="sourceLine" id="cb160-47" data-line-number="47"><span class="co"># Category</span></a>
<a class="sourceLine" id="cb160-48" data-line-number="48"><span class="co"># Again, as before, looking at the website content first</span></a>
<a class="sourceLine" id="cb160-49" data-line-number="49">links_by_categories_<span class="dv">2018</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/misc/2018_links_from_categories.csv&quot;</span>)</a>
<a class="sourceLine" id="cb160-50" data-line-number="50">links_by_categories_<span class="dv">2017</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;outputs/misc/2017_links_from_categories.csv&quot;</span>)</a>
<a class="sourceLine" id="cb160-51" data-line-number="51">links_by_categories &lt;-<span class="st"> </span><span class="kw">rbind</span>(links_by_categories_<span class="dv">2017</span>, links_by_categories_<span class="dv">2018</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-52" data-line-number="52"><span class="st">  </span><span class="kw">select</span>(category, product, year)</a>
<a class="sourceLine" id="cb160-53" data-line-number="53"><span class="kw">rm</span>(links_by_categories_<span class="dv">2017</span>, links_by_categories_<span class="dv">2018</span>)</a>
<a class="sourceLine" id="cb160-54" data-line-number="54"></a>
<a class="sourceLine" id="cb160-55" data-line-number="55">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-56" data-line-number="56"><span class="st">  </span><span class="kw">left_join</span>(links_by_categories, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span> =<span class="st"> &quot;year&quot;</span>,</a>
<a class="sourceLine" id="cb160-57" data-line-number="57">                                        <span class="st">&quot;for_matching&quot;</span> =<span class="st"> &quot;product&quot;</span>))</a>
<a class="sourceLine" id="cb160-58" data-line-number="58"></a>
<a class="sourceLine" id="cb160-59" data-line-number="59">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-60" data-line-number="60"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">category_brute_force =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb160-61" data-line-number="61">    <span class="kw">str_detect</span>(product, <span class="st">&quot;accessories&quot;</span>) <span class="op">~</span><span class="st"> &quot;Accessory&quot;</span>,</a>
<a class="sourceLine" id="cb160-62" data-line-number="62">    <span class="kw">str_detect</span>(product, <span class="st">&quot;bracelets&quot;</span>) <span class="op">~</span><span class="st"> &quot;Bracelet&quot;</span>,</a>
<a class="sourceLine" id="cb160-63" data-line-number="63">    <span class="kw">str_detect</span>(product, <span class="st">&quot;clasps&quot;</span>) <span class="op">~</span><span class="st"> &quot;Clasp&quot;</span>,</a>
<a class="sourceLine" id="cb160-64" data-line-number="64">    <span class="kw">str_detect</span>(product, <span class="st">&quot;earrings&quot;</span>) <span class="op">~</span><span class="st"> &quot;Earrings&quot;</span>,</a>
<a class="sourceLine" id="cb160-65" data-line-number="65">    <span class="kw">str_detect</span>(product, <span class="st">&quot;necklaces&quot;</span>) <span class="op">~</span><span class="st"> &quot;Necklace&quot;</span>,</a>
<a class="sourceLine" id="cb160-66" data-line-number="66">    <span class="kw">str_detect</span>(product, <span class="st">&quot;rings&quot;</span>) <span class="op">~</span><span class="st"> &quot;Ring&quot;</span>,</a>
<a class="sourceLine" id="cb160-67" data-line-number="67">    <span class="kw">str_detect</span>(product, <span class="st">&quot;petite-circle-strand&quot;</span>) <span class="op">~</span><span class="st"> &quot;Necklace&quot;</span>,</a>
<a class="sourceLine" id="cb160-68" data-line-number="68">    <span class="kw">str_detect</span>(product, <span class="st">&quot;baroque-strand&quot;</span>) <span class="op">~</span><span class="st"> &quot;Necklace&quot;</span>,</a>
<a class="sourceLine" id="cb160-69" data-line-number="69">    <span class="kw">str_detect</span>(product, <span class="st">&quot;gold-keshi-rhapsody&quot;</span>) <span class="op">~</span><span class="st"> &quot;Necklace&quot;</span>,</a>
<a class="sourceLine" id="cb160-70" data-line-number="70">    <span class="kw">str_detect</span>(product, <span class="st">&quot;keshi-rope-strand-of-the-harvest&quot;</span>) <span class="op">~</span><span class="st"> &quot;Necklace&quot;</span>,</a>
<a class="sourceLine" id="cb160-71" data-line-number="71">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span></a>
<a class="sourceLine" id="cb160-72" data-line-number="72">  ))</a>
<a class="sourceLine" id="cb160-73" data-line-number="73"></a>
<a class="sourceLine" id="cb160-74" data-line-number="74">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-75" data-line-number="75"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">category =</span> <span class="kw">if_else</span>(<span class="kw">is.na</span>(category), category_brute_force, category)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-76" data-line-number="76"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>category_brute_force) </a>
<a class="sourceLine" id="cb160-77" data-line-number="77"></a>
<a class="sourceLine" id="cb160-78" data-line-number="78">the_data<span class="op">$</span>category[the_data<span class="op">$</span>category <span class="op">==</span><span class="st"> &quot;necklaces_and_pendants&quot;</span>] &lt;-<span class="st"> &quot;Necklaces and Pendants&quot;</span></a>
<a class="sourceLine" id="cb160-79" data-line-number="79">the_data<span class="op">$</span>category[the_data<span class="op">$</span>category <span class="op">==</span><span class="st"> &quot;Necklace&quot;</span>] &lt;-<span class="st"> &quot;Necklaces and Pendants&quot;</span></a>
<a class="sourceLine" id="cb160-80" data-line-number="80">the_data<span class="op">$</span>category[the_data<span class="op">$</span>category <span class="op">==</span><span class="st"> &quot;necklaces&quot;</span>] &lt;-<span class="st"> &quot;Necklaces and Pendants&quot;</span></a>
<a class="sourceLine" id="cb160-81" data-line-number="81"></a>
<a class="sourceLine" id="cb160-82" data-line-number="82">the_data<span class="op">$</span>category &lt;-<span class="st"> </span><span class="kw">str_to_title</span>(the_data<span class="op">$</span>category , <span class="dt">locale =</span> <span class="st">&quot;en&quot;</span>)</a></code></pre></div>
<p>We think that there might be a difference between keshi pearls and non-keshi pearls. (My knowledge here is based solely on what Paspaley salespeople have told me, but I think that Keshi form naturally so they don’t have a little round ball in the middle of them, whereas non-keshi have been implanted and then the oyster coats it with the pearl substance.) We’d also like to pull out the shape of the pearl (round, triangle, etc), and the metal (white gold, rose gold, etc).</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="co"># Identify whether keshi pearl</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">keshi =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb161-4" data-line-number="4">    <span class="kw">str_detect</span>(product, <span class="st">&quot;keshi&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb161-5" data-line-number="5">    <span class="kw">str_detect</span>(name, <span class="st">&quot;Keshi&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb161-6" data-line-number="6">    <span class="kw">str_detect</span>(description, <span class="st">&quot;Keshi&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb161-7" data-line-number="7">    <span class="kw">str_detect</span>(description, <span class="st">&quot;keshi&quot;</span>) <span class="op">~</span><span class="st"> </span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb161-8" data-line-number="8">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb161-9" data-line-number="9">  ))</a>
<a class="sourceLine" id="cb161-10" data-line-number="10"></a>
<a class="sourceLine" id="cb161-11" data-line-number="11"></a>
<a class="sourceLine" id="cb161-12" data-line-number="12"><span class="co"># Metal</span></a>
<a class="sourceLine" id="cb161-13" data-line-number="13">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-14" data-line-number="14"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">metal =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb161-15" data-line-number="15">    <span class="kw">str_detect</span>(name, <span class="st">&quot;White Gold&quot;</span>) <span class="op">~</span><span class="st"> &quot;White gold&quot;</span>,</a>
<a class="sourceLine" id="cb161-16" data-line-number="16">    <span class="kw">str_detect</span>(name, <span class="st">&quot;Yellow Gold&quot;</span>) <span class="op">~</span><span class="st"> &quot;Yellow gold&quot;</span>,</a>
<a class="sourceLine" id="cb161-17" data-line-number="17">    <span class="kw">str_detect</span>(name, <span class="st">&quot;Rose Gold&quot;</span>) <span class="op">~</span><span class="st"> &quot;Rose gold&quot;</span>,</a>
<a class="sourceLine" id="cb161-18" data-line-number="18">    <span class="kw">str_detect</span>(name, <span class="st">&quot;Platinum&quot;</span>) <span class="op">~</span><span class="st"> &quot;Platinum&quot;</span>,</a>
<a class="sourceLine" id="cb161-19" data-line-number="19">    <span class="kw">str_detect</span>(description, <span class="st">&quot;white gold&quot;</span>) <span class="op">~</span><span class="st"> &quot;White gold&quot;</span>,</a>
<a class="sourceLine" id="cb161-20" data-line-number="20">    <span class="kw">str_detect</span>(description, <span class="st">&quot;yellow gold&quot;</span>) <span class="op">~</span><span class="st"> &quot;Yellow gold&quot;</span>,</a>
<a class="sourceLine" id="cb161-21" data-line-number="21">    <span class="kw">str_detect</span>(description, <span class="st">&quot;rose gold&quot;</span>) <span class="op">~</span><span class="st"> &quot;Rose gold&quot;</span>,</a>
<a class="sourceLine" id="cb161-22" data-line-number="22">    <span class="kw">str_detect</span>(description, <span class="st">&quot;platinum&quot;</span>) <span class="op">~</span><span class="st"> &quot;Platinum&quot;</span>,</a>
<a class="sourceLine" id="cb161-23" data-line-number="23">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Other&quot;</span></a>
<a class="sourceLine" id="cb161-24" data-line-number="24">  ))</a>
<a class="sourceLine" id="cb161-25" data-line-number="25"></a>
<a class="sourceLine" id="cb161-26" data-line-number="26"><span class="co"># Pearl type</span></a>
<a class="sourceLine" id="cb161-27" data-line-number="27">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-28" data-line-number="28"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">description_lowered =</span> <span class="kw">str_to_lower</span>(description)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-29" data-line-number="29"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pearl_type =</span> <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb161-30" data-line-number="30">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;mother-of-pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Mother of pearl&quot;</span>,</a>
<a class="sourceLine" id="cb161-31" data-line-number="31">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;mother of pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Mother of pearl&quot;</span>,</a>
<a class="sourceLine" id="cb161-32" data-line-number="32">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;triangle pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Triangle&quot;</span>,</a>
<a class="sourceLine" id="cb161-33" data-line-number="33">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;round pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Round&quot;</span>,</a>
<a class="sourceLine" id="cb161-34" data-line-number="34">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;button pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Button&quot;</span>,</a>
<a class="sourceLine" id="cb161-35" data-line-number="35">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;semi-round pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Semi-round&quot;</span>,</a>
<a class="sourceLine" id="cb161-36" data-line-number="36">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;drop pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Drop&quot;</span>,</a>
<a class="sourceLine" id="cb161-37" data-line-number="37">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;circle pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Circle&quot;</span>,</a>
<a class="sourceLine" id="cb161-38" data-line-number="38">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;oval pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Oval&quot;</span>,</a>
<a class="sourceLine" id="cb161-39" data-line-number="39">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;round australian south sea pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Round&quot;</span>,</a>
<a class="sourceLine" id="cb161-40" data-line-number="40">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;round paspaley pearls&quot;</span>) <span class="op">~</span><span class="st"> &quot;Round&quot;</span>,</a>
<a class="sourceLine" id="cb161-41" data-line-number="41">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;oval drop australian south sea pearls&quot;</span>) <span class="op">~</span><span class="st"> &quot;Oval&quot;</span>,</a>
<a class="sourceLine" id="cb161-42" data-line-number="42">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;oval australian south sea pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Oval&quot;</span>,</a>
<a class="sourceLine" id="cb161-43" data-line-number="43">    <span class="kw">str_detect</span>(description_lowered, <span class="st">&quot;button australian south sea pearl&quot;</span>) <span class="op">~</span><span class="st"> &quot;Button&quot;</span>,</a>
<a class="sourceLine" id="cb161-44" data-line-number="44">    <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> &quot;Unsure&quot;</span></a>
<a class="sourceLine" id="cb161-45" data-line-number="45">  )) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb161-46" data-line-number="46"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>description_lowered)</a></code></pre></div>
<p>Finally, in anything that is written there are always typos and mistakes that fresh eyes notice, but that the author could read a thousand times and miss. So we’d like to fix a bit of the website content, so that they don’t continue into our dataset.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1"><span class="co"># Fix typos and inconsistencies</span></a>
<a class="sourceLine" id="cb162-2" data-line-number="2">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;in18kt&quot;</span>, <span class="st">&quot;in 18kt&quot;</span>)</a>
<a class="sourceLine" id="cb162-3" data-line-number="3">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;18ct white gold&quot;</span>, <span class="st">&quot;18kt white gold&quot;</span>) <span class="co"># Google says that ct refers to weight and kt refers to purity, so should be 18kt white gold etc?</span></a>
<a class="sourceLine" id="cb162-4" data-line-number="4">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;18ct yellow gold&quot;</span>, <span class="st">&quot;18kt yellow gold&quot;</span>)</a>
<a class="sourceLine" id="cb162-5" data-line-number="5">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;pearl  bracelet&quot;</span>, <span class="st">&quot;pearl bracelet&quot;</span>)</a>
<a class="sourceLine" id="cb162-6" data-line-number="6">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;feturing&quot;</span>, <span class="st">&quot;featuring&quot;</span>)</a>
<a class="sourceLine" id="cb162-7" data-line-number="7">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;Papsaley&quot;</span>, <span class="st">&quot;Paspaley&quot;</span>) <span class="co"># Frankly, I&#39;m suprised this didn&#39;t happen more often</span></a>
<a class="sourceLine" id="cb162-8" data-line-number="8">the_data<span class="op">$</span>name &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>name, <span class="st">&quot;Oval  - Yellow Gold&quot;</span>, <span class="st">&quot;Oval - Yellow Gold&quot;</span>)</a>
<a class="sourceLine" id="cb162-9" data-line-number="9">the_data<span class="op">$</span>name &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>name, <span class="st">&quot;Baroque  - White Gold&quot;</span>, <span class="st">&quot;Baroque - White Gold&quot;</span>)</a>
<a class="sourceLine" id="cb162-10" data-line-number="10">the_data<span class="op">$</span>name &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>name, <span class="st">&quot;Oval  - White Gold&quot;</span>, <span class="st">&quot;Oval - White Gold&quot;</span>)</a>
<a class="sourceLine" id="cb162-11" data-line-number="11">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;extrodinary&quot;</span>, <span class="st">&quot;extraordinary&quot;</span>)</a>
<a class="sourceLine" id="cb162-12" data-line-number="12">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;feauturing&quot;</span>, <span class="st">&quot;featuring&quot;</span>)</a>
<a class="sourceLine" id="cb162-13" data-line-number="13">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;fourty-eight&quot;</span>, <span class="st">&quot;forty-eight&quot;</span>)</a>
<a class="sourceLine" id="cb162-14" data-line-number="14">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;featruing&quot;</span>, <span class="st">&quot;featuring&quot;</span>)</a>
<a class="sourceLine" id="cb162-15" data-line-number="15">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;fotry-eight&quot;</span>, <span class="st">&quot;forty-eight&quot;</span>)</a>
<a class="sourceLine" id="cb162-16" data-line-number="16">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;suprisingly&quot;</span>, <span class="st">&quot;surprisingly&quot;</span>)</a>
<a class="sourceLine" id="cb162-17" data-line-number="17">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.(?=[:upper:][:lower:])&quot;</span>, <span class="st">&quot;. &quot;</span>) <span class="co"># There&#39;s a bunch with no space following the full stop at the end of the sentence.</span></a>
<a class="sourceLine" id="cb162-18" data-line-number="18">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.(?=A)&quot;</span>, <span class="st">&quot;. &quot;</span>)</a>
<a class="sourceLine" id="cb162-19" data-line-number="19">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;Freah&quot;</span>, <span class="st">&quot;Fresh&quot;</span>)</a>
<a class="sourceLine" id="cb162-20" data-line-number="20">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;ninty&quot;</span>, <span class="st">&quot;ninety&quot;</span>)</a>
<a class="sourceLine" id="cb162-21" data-line-number="21">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;Introducing Pearls My Way</span><span class="ch">\\</span><span class="st">. Tailor your look by choosing your preferred Australian South Sea pearls and earring hooks in your favourite shade of gold. Add some colour to your earrings with a variety of precious gemstones including rubies and diamonds</span><span class="ch">\\</span><span class="st">. Prefer to create your own Pearls My Way earrings</span><span class="ch">\\</span><span class="st">? Contact the Personal Shopper or visit your nearest boutique. Personal Shopper Recommendation:&quot;</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb162-22" data-line-number="22">the_data<span class="op">$</span>description &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(the_data<span class="op">$</span>description, <span class="st">&quot;Introducing Pearls My Way</span><span class="ch">\\</span><span class="st">. Tailor your look by choosing your preferred Australian South Sea pearls and earring hooks in your favourite shade of gold</span><span class="ch">\\</span><span class="st">. Add some colour to your earrings with a variety of precious gemstones including rubies and diamonds</span><span class="ch">\\</span><span class="st">. Prefer to create your own Pearls My Way earrings</span><span class="ch">\\</span><span class="st">? Contact Personal Shopper or visit your nearest boutique</span><span class="ch">\\</span><span class="st">. Personal Shopper Recommendation:&quot;</span>, <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb162-23" data-line-number="23"></a>
<a class="sourceLine" id="cb162-24" data-line-number="24">the_data &lt;-<span class="st"> </span>the_data[<span class="op">-</span><span class="dv">160</span>,] <span class="co"># For some reason Odyssey Swap is in there twice for 2017. I know you&#39;re not meant to do the removal this way, but here we are.</span></a>
<a class="sourceLine" id="cb162-25" data-line-number="25"></a>
<a class="sourceLine" id="cb162-26" data-line-number="26"><span class="co"># Combine the description and the flowery description (2018 has the split, but 2017 doesn&#39;t)</span></a>
<a class="sourceLine" id="cb162-27" data-line-number="27">the_data &lt;-<span class="st"> </span>the_data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb162-28" data-line-number="28"><span class="st">  </span><span class="kw">unite</span>(description, description, flowerydescription, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) </a>
<a class="sourceLine" id="cb162-29" data-line-number="29"></a>
<a class="sourceLine" id="cb162-30" data-line-number="30"><span class="co"># Save the data</span></a>
<a class="sourceLine" id="cb162-31" data-line-number="31"><span class="kw">write_csv</span>(the_data, <span class="st">&quot;outputs/data/cleaned_dataset.csv&quot;</span>)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case-study-rohans-books.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="lab-ggplot2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["test.pdf", "test.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
